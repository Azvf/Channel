/* ========================================
   LAYER 4: SWITCHERS COMPONENT
   Theme Switcher & Tab Switcher
   ======================================== */

/* ========================================
   THEME SWITCHER
   ======================================== */

.theme-switcher-container {
  position: fixed;
  bottom: 2rem;
  right: 2rem;
  /* [Refactor] 使用明确的 Toast 层级 */
  z-index: var(--z-toast);
  transform-origin: bottom right;
}

body[data-edit-dialog-open] .theme-switcher-container {
  display: none;
}

.theme-switcher-backdrop {
  position: fixed;
  inset: 0;
  background: transparent;
  /* [Refactor] 使用明确的 Toast 层级 */
  z-index: var(--z-toast);
  pointer-events: none;
  opacity: 0;
  transition: opacity var(--transition-base) var(--ease-smooth);
  will-change: opacity;
}

.theme-switcher-container[data-expanded="true"] .theme-switcher-backdrop {
  pointer-events: auto;
  opacity: 1;
}

.theme-switcher-expanded {
  position: absolute;
  bottom: 0;
  right: 0;
  display: flex;
  overflow: hidden;
  /* [Refactor] 使用明确的 Toast 层级 */
  z-index: var(--z-toast);
  transform-origin: bottom right;
  will-change: width, height, padding, transform;
  transition: width var(--transition-base) var(--ease-smooth),
              height var(--transition-base) var(--ease-smooth),
              padding var(--transition-base) var(--ease-smooth),
              transform var(--transition-fast) var(--ease-smooth);
  margin: 0;
}

.theme-switcher-container[data-expanded="false"] .theme-switcher-expanded {
  /* [Refactor] 3rem (48px) -> var(--space-12) */
  width: var(--space-12);
  height: var(--space-12);
  padding: 0;
  /* [Design] Liquid Conformality: 使用语义化变量，替代硬编码的 99em */
  border-radius: var(--radius-full);
  cursor: pointer;
  transform: scale(1);
  justify-content: center;
  gap: 0;
  transition: width var(--transition-base) var(--ease-smooth),
              height var(--transition-base) var(--ease-smooth),
              padding var(--transition-base) var(--ease-smooth),
              transform var(--transition-fast) var(--ease-smooth),
              gap var(--transition-base) var(--ease-smooth),
              justify-content var(--transition-base);
}

.theme-switcher-container[data-expanded="false"] .theme-switcher-expanded:hover {
  transform: scale(1.1);
}

.theme-switcher-container[data-expanded="true"] .theme-switcher-expanded {
  /* [Refactor] 使用全局 Token，确保与设计系统对齐 */
  /* [Refactor] 保留为局部变量，因为这是特定于 switcher 的尺寸
     3.4rem (54.4px) 不在标准间距网格上，但这是为了精确控制 3 个图标的布局
     如果未来需要对齐到网格，可以使用 calc(var(--space-12) + var(--space-2)) = 48px + 8px = 56px */
  --switcher-icon-width: 3.4rem;
  --switcher-gap: var(--space-2); /* 0.4rem -> 8px */
  --switcher-padding-h: var(--space-2_5); /* 0.6rem -> 10px (接近) */
  --switcher-padding-v: var(--space-2); /* 0.4rem -> 8px */
  width: calc(
    (var(--switcher-icon-width) * 3) +
    (var(--switcher-gap) * 2) +
    (var(--switcher-padding-h) * 2)
  );
  /* [Refactor] 3.5rem (56px) -> var(--control-height-lg) */
  height: var(--control-height-lg);
  padding: var(--switcher-padding-v) var(--switcher-padding-h) var(--space-2);
  /* [Design] Liquid Conformality: 使用语义化变量，替代硬编码的 99em */
  border-radius: var(--radius-full);
  cursor: default;
  transform: scale(1);
}

/* Base switcher styles */
.switcher {
  display: flex;
  align-items: center;
  justify-content: flex-start;
  gap: var(--space-1_5); /* 0.4rem -> 6px approx */
  width: calc(
    (var(--switcher-icon-width, 3.4rem) * 3) +
    (var(--switcher-gap, var(--space-2)) * 2) +
    (var(--switcher-padding-h, var(--space-2_5)) * 2)
  );
  max-width: calc(
    (var(--switcher-icon-width, 3.4rem) * 3) +
    (var(--switcher-gap, var(--space-2)) * 2) +
    (var(--switcher-padding-h, var(--space-2_5)) * 2)
  );
  /* [Refactor] 3.5rem (56px) -> var(--control-height-lg) */
  height: var(--control-height-lg);
  box-sizing: border-box;
  padding: var(--space-1_5) var(--space-2_5) var(--space-2);
  margin: 0 auto;
  border: none;
  /* [Design] Liquid Conformality: 使用语义化变量，替代硬编码的 99em */
  border-radius: var(--radius-full);
  /* [Refactor] 12% mix -> var(--bg-surface-glass) (10%)，统一使用标准玻璃背景 Token */
  background-color: var(--bg-surface-glass);
  /* [Refactor] blur(8px) -> var(--glass-blur-base) (12px)，统一磨砂质感 */
  backdrop-filter: blur(var(--glass-blur-base)) url(#switcher) saturate(var(--saturation));
  -webkit-backdrop-filter: blur(var(--glass-blur-base)) saturate(var(--saturation));
  /* [Refactor] 使用组件级阴影 Token */
  box-shadow: var(--shadow-switcher-track);
  transition: background-color var(--transition-slow) var(--ease-glass),
              box-shadow var(--transition-slow) var(--ease-glass);
}

.switcher__legend {
  position: absolute;
  width: 1px;
  height: 1px;
  margin: -1px;
  border: 0;
  padding: 0;
  white-space: nowrap;
  clip-path: inset(100%);
  clip: rect(0 0 0 0);
  overflow: hidden;
}

.switcher__input {
  clip: rect(0 0 0 0);
  clip-path: inset(100%);
  height: 1px;
  width: 1px;
  overflow: hidden;
  position: absolute;
  white-space: nowrap;
}

.switcher__icon {
  display: block;
  width: 100%;
  transition: color var(--transition-fast) var(--ease-smooth),
              scale var(--transition-fast) var(--ease-smooth);
}

.switcher__filter {
  position: absolute;
  width: 0;
  height: 0;
  z-index: -1;
}

.switcher__option {
  --c: var(--c-content);
  display: flex;
  justify-content: center;
  align-items: center;
  box-sizing: border-box;
  overflow: hidden;
  /* [Design] Liquid Conformality: 使用语义化变量，替代硬编码的 99em */
  border-radius: var(--radius-full);
  z-index: var(--z-content);
  position: relative;
  transition: width var(--transition-base) var(--ease-smooth), 
              opacity var(--transition-fast) var(--ease-smooth),
              transform var(--transition-base) var(--ease-smooth);
  will-change: width, opacity, transform;
}

.theme-switcher-container .theme-switcher-expanded .switcher__option:hover {
  --c: var(--c-action);
  cursor: pointer;
}

.theme-switcher-container[data-expanded="true"] .theme-switcher-expanded .switcher__option:hover .switcher__icon {
  scale: 1.2;
}

.theme-switcher-container[data-expanded="false"] .theme-switcher-expanded .switcher__option:hover .switcher__icon {
  scale: 1.15;
}

.theme-switcher-container[data-expanded="true"] .theme-switcher-expanded .switcher__option {
  width: var(--switcher-icon-width);
  height: 100%;
  padding: 0 var(--space-3); /* 0.8rem -> 12px approx */
  opacity: 1;
  transform: translateX(0);
  transition-delay: 100ms;
}

.theme-switcher-container[data-expanded="false"] .theme-switcher-expanded .switcher__option {
  width: 0;
  /* [Refactor] 3rem (48px) -> var(--space-12) */
  height: var(--space-12);
  padding: 0;
  opacity: 0;
  transform: translateX(100%);
  /* [Refactor] 使用标准过渡时间 Token */
  transition-duration: var(--transition-fast);
  /* [Refactor] 0ms 延迟表示立即执行，保持为 0ms */
  transition-delay: 0ms;
}

.theme-switcher-container[data-expanded="false"] .theme-switcher-expanded .switcher__option:has(input:checked) {
  /* [Refactor] 3rem (48px) -> var(--space-12) */
  width: var(--space-12);
  height: var(--space-12);
  opacity: 1;
  transform: translateX(0);
  display: flex;
  justify-content: center;
  align-items: center;
  padding: 0;
  margin: 0;
  flex-shrink: 0;
  /* [Refactor] 0ms 延迟表示立即执行，保持为 0ms */
  transition-delay: 0ms;
  transition: width var(--transition-base) var(--ease-smooth),
              transform var(--transition-base) var(--ease-smooth),
              opacity 0ms;
}

.switcher__option:has(input:checked) {
  --c: var(--c-content);
  cursor: auto;
}

.switcher__option:has(input:checked) .switcher__icon {
  scale: 1;
}

.switcher::after {
  content: '';
  position: absolute;
  display: block;
  /* [Design] Liquid Conformality: 使用语义化变量，替代硬编码的 99em */
  border-radius: var(--radius-full);
  /* [Refactor] 36% mix -> var(--bg-surface-glass-active) (20%)，使用更接近的语义化 Token */
  /* 注意：36% 较重，但 active 状态(20%)是最接近的语义化选择 */
  background-color: var(--bg-surface-glass-active);
  z-index: var(--z-base);
  /* [Refactor] blur(8px) -> var(--glass-blur-base) (12px)，统一磨砂质感 */
  backdrop-filter: blur(var(--glass-blur-base)) url(#switcher) saturate(var(--saturation));
  -webkit-backdrop-filter: blur(var(--glass-blur-base)) saturate(var(--saturation));
  /* [Refactor] 使用组件级阴影 Token */
  box-shadow: var(--shadow-glass-button-inner);
  transition: width var(--transition-base) var(--ease-smooth),
              height var(--transition-base) var(--ease-smooth),
              translate var(--transition-slow) var(--ease-smooth),
              opacity var(--transition-fast) var(--ease-smooth),
              backdrop-filter var(--transition-slow) var(--ease-glass);
  will-change: width, height, translate, opacity;
}

.theme-switcher-container[data-expanded="false"] .theme-switcher-expanded::after {
  /* [Refactor] 3rem (48px) -> var(--space-12) */
  width: var(--space-12);
  height: var(--space-12);
  left: 0;
  top: 0;
  translate: 0 0;
  /* [Design] Liquid Conformality: 使用语义化变量，替代硬编码的 99em */
  border-radius: var(--radius-full);
  opacity: 0;
  visibility: hidden;
  /* [Refactor] 0ms 延迟表示立即执行，保持为 0ms */
  transition-delay: 0ms;
}

.theme-switcher-container[data-expanded="true"] .theme-switcher-expanded::after {
  /* [Refactor] 0.8rem -> var(--space-4), 0.5rem -> var(--space-2), 0.2rem -> var(--space-0_5) */
  width: calc(var(--switcher-icon-width) + var(--space-4));
  height: calc(100% - var(--space-2));
  left: var(--space-0_5);
  top: var(--space-0_5);
  /* [Design] Liquid Conformality: 使用语义化变量，替代硬编码的 99em */
  border-radius: var(--radius-full);
  opacity: 1;
  visibility: visible;
  /* [Refactor] 11rem -> 动态计算，基于变量确保动画正确对齐 */
  /* 这是初始状态或特定状态的偏移，使用 calc 保持与后续状态的逻辑一致 */
  /* 注意：实际位置由 :has(input[data-option="*"]:checked) 选择器控制 */
  translate: calc((var(--switcher-icon-width) + var(--switcher-gap)) * 2) 0;
  transition-delay: calc(var(--transition-fast) / 2);
}

.theme-switcher-container[data-expanded="true"] .theme-switcher-expanded:has(input[data-option="1"]:checked)::after {
  translate: 0 0;
}

.theme-switcher-container[data-expanded="true"] .theme-switcher-expanded:has(input[data-option="2"]:checked)::after {
  translate: calc(var(--switcher-icon-width) + var(--switcher-gap)) 0;
}

.theme-switcher-container[data-expanded="true"] .theme-switcher-expanded:has(input[data-option="3"]:checked)::after {
  translate: calc((var(--switcher-icon-width) + var(--switcher-gap)) * 2) 0;
}

/* ========================================
   TAB SWITCHER
   ======================================== */

.tab-switcher {
  position: relative;
  width: 100%;
  max-width: 28rem;
  /* [Refactor] 3.25rem (52px) -> var(--control-height-lg) (56px) 对齐到标准控件高度，提升触控体验 */
  height: var(--control-height-lg);
  /* [Refactor] 0.4rem -> var(--space-2) */
  padding: var(--space-2);
  /* [Design] 定义覆盖层间距变量，使用语义化变量确保与选项内容区域对齐 */
  /* 底部间距略大于顶部，让覆盖层略微下移以更好地对齐选项内容 */
  --tab-switcher-overlay-inset-top: var(--space-0_5);
  --tab-switcher-overlay-inset-bottom: var(--space-0_5);
  --tab-switcher-overlay-inset-horizontal: var(--space-0_5);
  /* [Refactor] 统一使用标准玻璃背景 Token，与 ExpandableSwitcher 保持一致 */
  background-color: var(--bg-surface-glass);
  /* [Refactor] blur(8px) -> var(--glass-blur-base) (12px)，统一磨砂质感 */
  backdrop-filter: blur(var(--glass-blur-base)) url(#tab-switcher) saturate(var(--saturation));
  -webkit-backdrop-filter: blur(var(--glass-blur-base)) saturate(var(--saturation));
  /* [Refactor] 使用组件级阴影 Token，与 ExpandableSwitcher 保持一致 */
  box-shadow: var(--shadow-switcher-track);
  transition: background-color var(--transition-slow) var(--ease-glass),
              box-shadow var(--transition-slow) var(--ease-glass);
}

.tab-switcher .switcher__option {
  flex: 1;
  /* [Refactor] 1.5rem (24px) -> var(--space-6) */
  padding: 0 var(--space-6);
}

.tab-switcher .switcher__option,
.tab-switcher .switcher__icon-wrapper,
.tab-switcher .switcher__label {
  user-select: none;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
}

.tab-switcher .switcher__icon-wrapper {
  display: flex;
  align-items: center;
  /* [Refactor] 0.6rem -> var(--space-2_5) */
  gap: var(--space-2_5);
  width: 100%;
  justify-content: center;
}

.tab-switcher .switcher__icon {
  /* [Refactor] 移除硬编码尺寸，使用 icon-sm 工具类控制 */
  transition: color var(--transition-fast) var(--ease-smooth),
              scale var(--transition-fast) var(--ease-smooth);
}

.tab-switcher .switcher__option:hover:not(:has(input:checked)) {
  --c: var(--c-action);
  cursor: pointer;
}

.tab-switcher .switcher__option:hover:not(:has(input:checked)) .switcher__icon {
  scale: 1.15;
}

.tab-switcher .switcher__option:hover:not(:has(input:checked)) .switcher__label {
  color: var(--c-action);
}

.tab-switcher .switcher__label {
  transition: color var(--transition-fast) var(--ease-smooth);
  pointer-events: none;
}

.tab-switcher::after {
  content: '';
  position: absolute;
  display: block;
  /* [Design] 使用语义化变量设置垂直间距，确保覆盖层与选项内容区域对齐 */
  /* 顶部间距：var(--space-0_5)，底部间距：var(--space-1)（略微下移以对齐内容） */
  top: var(--tab-switcher-overlay-inset-top);
  bottom: var(--tab-switcher-overlay-inset-bottom);
  /* [Design] 水平位置和宽度：每个 option 占 50%，减去左右各 var(--space-0_5) 的间距 */
  left: var(--tab-switcher-overlay-inset-horizontal);
  width: calc(50% - var(--space-0_5));
  /* [Design] Liquid Conformality: 使用语义化变量，替代硬编码的 99em */
  border-radius: var(--radius-full);
  /* [Fix] 使用 var(--bg-surface-glass-active) (20%) 以匹配激活状态，与 ExpandableSwitcher 保持一致 */
  background-color: var(--bg-surface-glass-active);
  /* [Fix] 使用 var(--z-base) 而不是 -1，确保 glass 效果在内容之上，与 ExpandableSwitcher 保持一致 */
  z-index: var(--z-base);
  box-sizing: border-box;
  /* [Fix] 添加 backdrop-filter 效果以匹配 ExpandableSwitcher 的玻璃态 */
  backdrop-filter: blur(var(--glass-blur-base)) url(#tab-switcher) saturate(var(--saturation));
  -webkit-backdrop-filter: blur(var(--glass-blur-base)) saturate(var(--saturation));
  /* [Fix] 使用组件级阴影 Token，与 ExpandableSwitcher 保持一致 */
  box-shadow: var(--shadow-glass-button-inner);
  transition: top var(--transition-base) var(--ease-smooth),
              bottom var(--transition-base) var(--ease-smooth),
              left var(--transition-slow) var(--ease-smooth),
              translate var(--transition-slow) var(--ease-smooth),
              width var(--transition-base) var(--ease-smooth),
              background-color var(--transition-slow) var(--ease-glass),
              box-shadow var(--transition-slow) var(--ease-glass),
              backdrop-filter var(--transition-slow) var(--ease-glass);
  will-change: top, bottom, left, translate, width;
}

.tab-switcher:has(input[data-option="1"]:checked)::after,
.tab-switcher:has(input[data-option="2"]:checked)::after {
  /* [Design] 参考 ExpandableSwitcher 的设计，使用 translate 而不是 left 来移动 */
  /* 宽度保持为每个 option 的宽度，与基础样式保持一致 */
  width: calc(50% - var(--space-0_5));
  /* [Design] 使用语义化变量确保垂直对齐 */
  top: var(--tab-switcher-overlay-inset-top);
  bottom: var(--tab-switcher-overlay-inset-bottom);
  translate: 0 0;
  transition: top var(--transition-base) var(--ease-smooth),
              bottom var(--transition-base) var(--ease-smooth),
              left var(--transition-slow) var(--ease-smooth),
              width var(--transition-base) var(--ease-smooth),
              translate var(--transition-slow) var(--ease-smooth),
              background-color var(--transition-slow) var(--ease-glass),
              box-shadow var(--transition-slow) var(--ease-glass),
              backdrop-filter var(--transition-slow) var(--ease-glass);
}

.tab-switcher:has(input[data-option="1"]:checked)::after {
  /* [Design] 第一个 tab：从左侧偏移使用语义化变量，translate 为 0 */
  left: var(--tab-switcher-overlay-inset-horizontal);
  translate: 0 0;
  transform-origin: right;
}

.tab-switcher:has(input[data-option="2"]:checked)::after {
  /* [Design] 第二个 tab：移动到右侧，使用基于覆盖层自身宽度的 translate 计算 */
  /* 覆盖层宽度是 calc(50% - var(--space-0_5))，约等于容器宽度的 50% */
  /* 要移动到第二个选项（容器宽度的 50% 位置），需要移动覆盖层自身宽度的 100% */
  /* 这样覆盖层左边缘会从 var(--tab-switcher-overlay-inset-horizontal) 移动到 50% 位置，精确对齐第二个选项 */
  left: var(--tab-switcher-overlay-inset-horizontal);
  translate: 100% 0;
  transform-origin: left;
}

.tab-switcher[data-previous="1"]:has(input[data-option="2"]:checked)::after {
  transform-origin: left;
}

.tab-switcher[data-previous="2"]:has(input[data-option="1"]:checked)::after {
  transform-origin: right;
}

