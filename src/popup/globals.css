/* @custom-variant dark (&:is(.dark *)); */
@tailwind base;
@layer base {
  /* * {
    @apply border-border outline-ring/50;
  } */

  body {
    --c-glass: #bbbbbc;
    --c-light: #fff;
    --c-dark: #000;
    
    --c-content: #224;
    --c-action: #0052f5;
    
    --c-bg: #E8E8E9;
    
    --glass-reflex-dark: 1;
    --glass-reflex-light: 1;
    
    --saturation: 150%;
    
    /* 动画时间变量 */
    --transition-fast: 200ms;
    --transition-base: 300ms;
    --transition-slow: 400ms;
    
    /* 缓动函数变量 */
    --ease-smooth: cubic-bezier(0.4, 0, 0.2, 1);
    --ease-glass: cubic-bezier(1, 0.0, 0.4, 1);
    
    font-size: 20px;
    background: var(--c-bg);
    color: var(--c-content);
    
    /* 默认禁用过渡，避免主题切换时的闪烁 */
    /* transition 将在 JavaScript 中通过 data-theme-ready 属性启用 */
    transition: none;
  }

  :root {
    /* --- Z-Index 系统 --- */
    
    /* 级别 0: 隐藏 */
    --z-hidden: -1;
    
    /* 级别 1: 组件内部 (例如：毛玻璃滑块) */
    --z-base: 1;
    
    /* 级别 2: 组件内容 (例如：滑块上的图标) */
    --z-content: 2;
    
    /* 级别 3: 粘性元素 (例如：Sticky Header, Hover效果) */
    --z-sticky: 10;
    
    /* 级别 4: 应用主 UI (例如：App 浮动顶栏) */
    --z-app-header: 20;

    /* 级别 5: 下拉菜单 (例如：TagInput 的建议列表) */
    --z-dropdown: 30;

    /* 级别 6: 模态框 (所有弹窗，如 Settings, Stats, Edit) */
    --z-modal-layer: 40;

    /* 级别 7: 提示框 (例如：PagePreview 浮窗) */
    --z-tooltip-layer: 50;
    
    /* 级别 8: 上下文菜单 (右键菜单，必须在 Tooltip 之上) */
    --z-context-menu-layer: 60;

    /* 级别 9: 系统 UI (最高层，例如 ThemeSwitcher) */
    --z-system-layer: 100;

    /* --- [新增] 字体族 (Font Family) --- */
    --font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
      'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
      sans-serif;

    /* --- [新增] 1. 排版令牌 (Typography Tokens) --- */

    /* 1.1rem, 600 (用于页面主标题, e.g., TaggingPage, TaggedPage) */
    --font-page-title: 600 1.1rem/1.35 var(--font-family);
    --letter-spacing-page-title: -0.015em;

    /* 1rem, 700 (用于 App/Modal 标题, e.g., "Channel", "Settings") */
    --font-header-title: 700 1rem/1.35 var(--font-family);
    --letter-spacing-header-title: -0.02em;

    /* 0.9rem, 500 (用于设置行、列表项) */
    --font-list-item: 500 0.9rem/1.4 var(--font-family);
    --letter-spacing-list-item: normal;

    /* 0.85rem, 400 (用于正文/输入框) */
    --font-body: 400 0.85rem/1.4 var(--font-family);
    --letter-spacing-body: 0.01em;

    /* 0.8rem, 400 (用于二级文本, e.g., URLs) */
    --font-caption: 400 0.8rem/1.4 var(--font-family);
    --letter-spacing-caption: 0.005em;

    /* 0.75rem, 600, UPPERCASE (用于设置组标题) */
    --font-section-title: 600 0.75rem/1.4 var(--font-family);
    --letter-spacing-section-title: 0.05em;

    /* 0.75rem, 400 (用于列表项的次要值或脚注) */
    --font-footnote: 400 0.75rem/1.4 var(--font-family);
    --letter-spacing-footnote: 0.01em;

    /* 0.75rem, 500 (用于 Tag 标签) */
    --font-tag: 500 0.75rem/1.4 var(--font-family);
    --letter-spacing-tag: 0.01em;

    /* 0.7rem, 500, UPPERCASE (用于模块标题, e.g., "Add Tags", "Search by Tags") */
    --font-module-title: 500 0.7rem/1.4 var(--font-family);
    --letter-spacing-module-title: 0.05em;

    /* --- [新增] 2. 颜色令牌 (Color Tokens) --- */

    /* 主要内容 (e.g., 标题, 列表项) */
    --color-text-primary: var(--c-content);

    /* 二级内容 (e.g., URL, 描述, 已选中的值) */
    --color-text-secondary: color-mix(in srgb, var(--c-content) 50%, transparent);

    /* 三级/禁用内容 (e.g., 空状态提示) */
    --color-text-tertiary: color-mix(in srgb, var(--c-content) 40%, transparent);

    /* 动作颜色 (e.g., 链接, 图标) */
    --color-text-action: var(--c-action);

    /* 模块标题颜色 (e.g., "Add Tags", "Search by Tags") */
    --color-text-module-title: color-mix(in srgb, var(--c-content) 70%, var(--c-bg));

    /* --- [新增] HOVER DESIGN TOKENS --- */

    /* 规则 A: "选中" (Glass) - 用于行和容器 */
    --hover-bg-glass: color-mix(in srgb, var(--c-glass) 15%, transparent);
    --hover-border-glass: color-mix(in srgb, var(--c-glass) 25%, transparent);

    /* 规则 B: "行动" (Action) - 用于按钮和菜单项 */
    --hover-bg-action: color-mix(in srgb, var(--c-action) 15%, transparent);
    --hover-color-action: var(--c-action);

    /* --- [新增] DESTRUCTIVE TOKENS --- */
    --color-destructive: #D0021B;
    --hover-bg-destructive: color-mix(in srgb, var(--color-destructive) 15%, transparent);
    --hover-color-destructive: var(--color-destructive);
  }
  
  /* 只有当 body 有 data-theme-ready 属性时才启用过渡效果 */
  body[data-theme-ready] {
    transition: background var(--transition-slow) var(--ease-glass), 
                color var(--transition-slow) var(--ease-glass);
  }
  
  /* 如果 body 上有 data-theme-no-transition，强制禁用过渡 */
  body[data-theme-no-transition] {
    transition: none !important;
  }

  body:has(input[value="dark"]:checked),
  body:has(input[name="theme-persist"][value="dark"]:checked) {
    --c-glass: #bbbbbc;
    --c-light: #fff;
    --c-dark: #000;
    
    --c-content: #e1e1e1;
    --c-action: #03d5ff;
    
    --c-bg: #1b1b1d;
    
    --glass-reflex-dark: 2;
    --glass-reflex-light: 0.3;
    
    --saturation: 150%;
  }

  body:has(input[value="dim"]:checked),
  body:has(input[name="theme-persist"][value="dim"]:checked) {
    --c-light: #99deff;
    --c-dark: #20001b;
    --c-glass: hsl(335 250% 74% / 1);
    
    --c-content: #d5dbe2;
    --c-action: #ff48a9;
    
    --c-bg: #152433;
    
    --glass-reflex-dark: 2;
    --glass-reflex-light: 0.7;
    
    --saturation: 200%;
  }
}

:root {
  --font-size: 20px;
  --background: #ffffff;
  --foreground: oklch(0.145 0 0);
  --card: #ffffff;
  --card-foreground: oklch(0.145 0 0);
  --popover: oklch(1 0 0);
  --popover-foreground: oklch(0.145 0 0);
  --primary: #030213;
  --primary-foreground: oklch(1 0 0);
  --secondary: oklch(0.95 0.0058 264.53);
  --secondary-foreground: #030213;
  --muted: #ececf0;
  --muted-foreground: #717182;
  --accent: #e9ebef;
  --accent-foreground: #030213;
  --destructive: #d4183d;
  --destructive-foreground: #ffffff;
  --border: rgba(0, 0, 0, 0.1);
  --input: transparent;
  --input-background: #f3f3f5;
  --switch-background: #cbced4;
  --font-weight-medium: 500;
  --font-weight-normal: 400;
  --ring: oklch(0.708 0 0);
  --chart-1: oklch(0.646 0.222 41.116);
  --chart-2: oklch(0.6 0.118 184.704);
  --chart-3: oklch(0.398 0.07 227.392);
  --chart-4: oklch(0.828 0.189 84.429);
  --chart-5: oklch(0.769 0.188 70.08);
  --radius: 0.625rem;
  --sidebar: oklch(0.985 0 0);
  --sidebar-foreground: oklch(0.145 0 0);
  --sidebar-primary: #030213;
  --sidebar-primary-foreground: oklch(0.985 0 0);
  --sidebar-accent: oklch(0.97 0 0);
  --sidebar-accent-foreground: oklch(0.205 0 0);
  --sidebar-border: oklch(0.922 0 0);
  --sidebar-ring: oklch(0.708 0 0);
}

.dark {
  --background: oklch(0.145 0 0);
  --foreground: oklch(0.985 0 0);
  --card: oklch(0.145 0 0);
  --card-foreground: oklch(0.985 0 0);
  --popover: oklch(0.145 0 0);
  --popover-foreground: oklch(0.985 0 0);
  --primary: oklch(0.985 0 0);
  --primary-foreground: oklch(0.205 0 0);
  --secondary: oklch(0.269 0 0);
  --secondary-foreground: oklch(0.985 0 0);
  --muted: oklch(0.269 0 0);
  --muted-foreground: oklch(0.708 0 0);
  --accent: oklch(0.269 0 0);
  --accent-foreground: oklch(0.985 0 0);
  --destructive: oklch(0.396 0.141 25.723);
  --destructive-foreground: oklch(0.637 0.237 25.331);
  --border: oklch(0.269 0 0);
  --input: oklch(0.269 0 0);
  --ring: oklch(0.439 0 0);
  --font-weight-medium: 500;
  --font-weight-normal: 400;
  --chart-1: oklch(0.488 0.243 264.376);
  --chart-2: oklch(0.696 0.17 162.48);
  --chart-3: oklch(0.769 0.188 70.08);
  --chart-4: oklch(0.627 0.265 303.9);
  --chart-5: oklch(0.645 0.246 16.439);
  --sidebar: oklch(0.205 0 0);
  --sidebar-foreground: oklch(0.985 0 0);
  --sidebar-primary: oklch(0.488 0.243 264.376);
  --sidebar-primary-foreground: oklch(0.985 0 0);
  --sidebar-accent: oklch(0.269 0 0);
  --sidebar-accent-foreground: oklch(0.985 0 0);
  --sidebar-border: oklch(0.269 0 0);
  --sidebar-ring: oklch(0.439 0 0);
}

/* Theme variables mapping */
:root {
  --color-background: var(--background);
  --color-foreground: var(--foreground);
  --color-card: var(--card);
  --color-card-foreground: var(--card-foreground);
  --color-popover: var(--popover);
  --color-popover-foreground: var(--popover-foreground);
  --color-primary: var(--primary);
  --color-primary-foreground: var(--primary-foreground);
  --color-secondary: var(--secondary);
  --color-secondary-foreground: var(--secondary-foreground);
  --color-muted: var(--muted);
  --color-muted-foreground: var(--muted-foreground);
  --color-accent: var(--accent);
  --color-accent-foreground: var(--accent-foreground);
  --color-destructive: var(--destructive);
  --color-destructive-foreground: var(--destructive-foreground);
  --color-border: var(--border);
  --color-input: var(--input);
  --color-input-background: var(--input-background);
  --color-switch-background: var(--switch-background);
  --color-ring: var(--ring);
  --color-chart-1: var(--chart-1);
  --color-chart-2: var(--chart-2);
  --color-chart-3: var(--chart-3);
  --color-chart-4: var(--chart-4);
  --color-chart-5: var(--chart-5);
  --radius-sm: calc(var(--radius) - 4px);
  --radius-md: calc(var(--radius) - 2px);
  --radius-lg: var(--radius);
  --radius-xl: calc(var(--radius) + 4px);
  --color-sidebar: var(--sidebar);
  --color-sidebar-foreground: var(--sidebar-foreground);
  --color-sidebar-primary: var(--sidebar-primary);
  --color-sidebar-primary-foreground: var(--sidebar-primary-foreground);
  --color-sidebar-accent: var(--sidebar-accent);
  --color-sidebar-accent-foreground: var(--sidebar-accent-foreground);
  --color-sidebar-border: var(--sidebar-border);
  --color-sidebar-ring: var(--sidebar-ring);
}

/**
 * Base typography. This is not applied to elements which have an ancestor with a Tailwind text class.
 */
@layer base {
  :where(:not(:has([class*=" text-"]), :not(:has([class^="text-"])))) {
    :is(h1) {
      font-size: var(--text-2xl);
      font-weight: var(--font-weight-medium);
      line-height: 1.5;
    }

    :is(h2) {
      font-size: var(--text-xl);
      font-weight: var(--font-weight-medium);
      line-height: 1.5;
    }

    :is(h3) {
      font-size: var(--text-lg);
      font-weight: var(--font-weight-medium);
      line-height: 1.5;
    }

    :is(h4) {
      font-size: var(--text-base);
      font-weight: var(--font-weight-medium);
      line-height: 1.5;
    }

    :is(p) {
      font-size: var(--text-base);
      font-weight: var(--font-weight-normal);
      line-height: 1.5;
    }

    :is(label) {
      font-size: var(--text-base);
      font-weight: var(--font-weight-medium);
      line-height: 1.5;
    }

    :is(button) {
      font-size: var(--text-base);
      font-weight: var(--font-weight-medium);
      line-height: 1.5;
    }

    :is(input) {
      font-size: var(--text-base);
      font-weight: var(--font-weight-normal);
      line-height: 1.5;
    }
  }
}

html {
  font-size: var(--font-size);
  scroll-behavior: smooth;
  /* Always show scrollbar to prevent layout shift */
  overflow-y: scroll;
}

/* Optimize backdrop-filter rendering */
[class*="backdrop-blur"],
.liquidGlass-effect {
  transform: translateZ(0);
  -webkit-font-smoothing: antialiased;
  -webkit-backface-visibility: hidden;
  backface-visibility: hidden;
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 12px;
}

::-webkit-scrollbar-track {
  background: color-mix(in srgb, var(--c-glass) 8%, transparent);
}

::-webkit-scrollbar-thumb {
  background: color-mix(in srgb, var(--c-glass) 24%, transparent);
  border-radius: 99em;
  border: 2px solid transparent;
  background-clip: content-box;
}

::-webkit-scrollbar-thumb:hover {
  background: color-mix(in srgb, var(--c-action) 40%, transparent);
  background-clip: content-box;
}

/* Firefox scrollbar */
* {
  scrollbar-width: thin;
  scrollbar-color: color-mix(in srgb, var(--c-glass) 24%, transparent) color-mix(in srgb, var(--c-glass) 8%, transparent);
}

/* Selection color */
::selection {
  background-color: color-mix(in srgb, var(--c-action) 30%, transparent);
  color: var(--c-content);
}

/* ========================================
   UTILITY CLASSES - 可复用样式
   ======================================== */

/* 防止选中文本 - 可复用类 */
.no-select {
  user-select: none;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
}

/* 可复用的过渡动画 */
.transition-smooth {
  transition: color var(--transition-fast) var(--ease-smooth),
              scale var(--transition-fast) var(--ease-smooth);
}

.transition-glass {
  transition: background-color var(--transition-slow) var(--ease-glass),
              box-shadow var(--transition-slow) var(--ease-glass);
}

/* ========================================
   PREMIUM GLASS EFFECT STYLES
   Based on switcher design system
   ======================================== */

.liquidGlass-wrapper {
  position: relative;
  display: flex;
  overflow: hidden;
  isolation: isolate;
  border-radius: 1.4em;
  
  /* [优化] 玻璃基色不透明度从 12% 提高到 15%，增加"实体感" */
  background-color: color-mix(in srgb, var(--c-glass) 15%, transparent); 
  
  /* [优化] 模糊半径从 8px 增加到 12px，更有深度；饱和度使用新变量 */
  backdrop-filter: blur(12px) saturate(var(--saturation));
  -webkit-backdrop-filter: blur(12px) saturate(var(--saturation));
  
  /* [优化] 调整阴影以匹配新的反射变量 
    (这些变量现在在 light 主题中是 '1' 和 '1'，效果会更均衡)
  */
  box-shadow: 
    inset 0 0 0 1.5px color-mix(in srgb, var(--c-light) calc(var(--glass-reflex-light) * 15%), transparent),
    inset 1.8px 3px 0px -2px color-mix(in srgb, var(--c-light) calc(var(--glass-reflex-light) * 70%), transparent), 
    inset -2px -2px 0px -2px color-mix(in srgb, var(--c-light) calc(var(--glass-reflex-light) * 60%), transparent), 
    inset -3px -8px 1px -6px color-mix(in srgb, var(--c-light) calc(var(--glass-reflex-light) * 40%), transparent), 
    inset -0.3px -1px 4px 0px color-mix(in srgb, var(--c-dark) calc(var(--glass-reflex-dark) * 8%), transparent),
    inset -1.5px 2.5px 0px -2px color-mix(in srgb, var(--c-dark) calc(var(--glass-reflex-dark) * 15%), transparent), 
    inset 0px 3px 4px -2px color-mix(in srgb, var(--c-dark) calc(var(--glass-reflex-dark) * 15%), transparent), 
    inset 2px -6.5px 1px -4px color-mix(in srgb, var(--c-dark) calc(var(--glass-reflex-dark) * 8%), transparent), 
    0px 1px 5px 0px color-mix(in srgb, var(--c-dark) calc(var(--glass-reflex-dark) * 8%), transparent), 
    0px 6px 16px 0px color-mix(in srgb, var(--c-dark) calc(var(--glass-reflex-dark) * 5%), transparent);
  
  transition: background-color var(--transition-slow) var(--ease-glass),
              box-shadow var(--transition-slow) var(--ease-glass);
}

.liquidGlass-content {
  position: relative;
  z-index: var(--z-content);
  width: 100%;
}

/* 当 wrapper 是 flex 容器时，content 也应该支持 flex 布局 */
.liquidGlass-wrapper.flex .liquidGlass-content,
.liquidGlass-wrapper.flex-col .liquidGlass-content {
  display: flex;
  height: 100%; /* 确保 content 占满 wrapper 的高度 */
}

.liquidGlass-wrapper.flex-col .liquidGlass-content {
  flex-direction: column;
}

/* Glass button style */
.glass-button {
  position: relative;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  padding: 0.6em 1.2em;
  border-radius: 99em;
  background-color: color-mix(in srgb, var(--c-glass) 36%, transparent);
  border: none;
  color: var(--c-content);
  cursor: pointer;
  font-family: inherit;
  font-size: inherit;
  font-weight: 400;
  box-shadow: 
    inset 0 0 0 1px color-mix(in srgb, var(--c-light) calc(var(--glass-reflex-light) * 10%), transparent),
    inset 2px 1px 0px -1px color-mix(in srgb, var(--c-light) calc(var(--glass-reflex-light) * 90%), transparent), 
    inset -1.5px -1px 0px -1px color-mix(in srgb, var(--c-light) calc(var(--glass-reflex-light) * 80%), transparent), 
    inset -2px -6px 1px -5px color-mix(in srgb, var(--c-light) calc(var(--glass-reflex-light) * 60%), transparent), 
    inset -1px 2px 3px -1px color-mix(in srgb, var(--c-dark) calc(var(--glass-reflex-dark) * 20%), transparent), 
    inset 0px -4px 1px -2px color-mix(in srgb, var(--c-dark) calc(var(--glass-reflex-dark) * 10%), transparent), 
    0px 3px 6px 0px color-mix(in srgb, var(--c-dark) calc(var(--glass-reflex-dark) * 8%), transparent);
  transition: all var(--transition-fast) var(--ease-smooth);
}

.glass-button:hover {
  color: var(--c-action);
  transform: scale(1.05);
}

.glass-button:active {
  transform: scale(0.98);
}

.glass-button.primary {
  background-color: color-mix(in srgb, var(--c-action) 80%, transparent);
  color: var(--c-light);
}

.glass-button.primary:hover {
  background-color: var(--c-action);
}

/* GlassButton 毁灭性变体 */
.glass-button.destructive:hover {
  color: var(--hover-color-destructive) !important;
  transform: scale(1.05);
}

/* SVG Filter for Glass Distortion */
.glass-filter {
  position: absolute;
  width: 0;
  height: 0;
  z-index: -1;
}

/* ========================================
   THEME SWITCHER STYLES
   ======================================== */

/* Hidden theme switcher container */
.theme-switcher-container {
  position: fixed;
  bottom: 2rem;
  right: 2rem;
  z-index: var(--z-system-layer);
  transform-origin: bottom right; /* 动画基点 */
}

/* 当对话框打开时隐藏 theme switcher */
body[data-edit-dialog-open] .theme-switcher-container {
  display: none;
}

/* 3. 背景遮罩 (Backdrop) */
.theme-switcher-backdrop {
  position: fixed;
  inset: 0;
  background: transparent;
  z-index: var(--z-system-layer); /* 在 Switcher 后面 */
  pointer-events: none;
  opacity: 0;
  /* 使用更平滑的 'ease-out' 曲线，持续 300ms
     使用 'will-change' 提示浏览器为 opacity 创建合成层 
  */
  transition: opacity var(--transition-base) var(--ease-smooth);
  will-change: opacity;
}

.theme-switcher-container[data-expanded="true"] .theme-switcher-backdrop {
  pointer-events: auto;
  opacity: 1;
}

/* 4. 主体 (Fieldset) */
.theme-switcher-expanded {
  position: absolute;
  bottom: 0;
  right: 0;
  display: flex;
  overflow: hidden;
  z-index: calc(var(--z-system-layer) + 1); /* 在 Backdrop 上面 */
  transform-origin: bottom right;
  will-change: width, height, padding, transform;

  /*
    动画:
    - 统一使用 'ease-in-out' 曲线
    - 统一使用 300ms 持续时间
    - transform 动画用于 :hover 效果 (200ms)
  */
  transition: width var(--transition-base) var(--ease-smooth),
              height var(--transition-base) var(--ease-smooth),
              padding var(--transition-base) var(--ease-smooth),
              transform var(--transition-fast) var(--ease-smooth);
  
  /* 移除可能冲突的 margin，因为使用 absolute 定位 */
  margin: 0;
}

/* 5. 主体 - 折叠态 (Collapsed) */
.theme-switcher-container[data-expanded="false"] .theme-switcher-expanded {
  width: 3rem;
  height: 3rem;
  padding: 0;
  border-radius: 99em; /* Force circle */
  cursor: pointer;
  transform: scale(1);
  /* 在折叠态，使用 justify-content: center 确保激活选项居中 */
  justify-content: center;
  gap: 0;
  /* 确保 hover 过渡平滑 */
  transition: width var(--transition-base) var(--ease-smooth),
              height var(--transition-base) var(--ease-smooth),
              padding var(--transition-base) var(--ease-smooth),
              transform var(--transition-fast) var(--ease-smooth),
              gap var(--transition-base) var(--ease-smooth),
              justify-content var(--transition-base); /* 平滑过渡对齐方式 */
}

/* 折叠态的 :hover 效果 */
.theme-switcher-container[data-expanded="false"] .theme-switcher-expanded:hover {
  transform: scale(1.1); /* 悬停时轻微放大 */
}

/* 6. 主体 - 展开态 (Expanded) */
.theme-switcher-container[data-expanded="true"] .theme-switcher-expanded {
  --switcher-icon-width: 3.4rem;
  --switcher-gap: 0.4rem;
  --switcher-padding-h: 0.6rem;
  --switcher-padding-v: 0.4rem;
  width: calc(
    (var(--switcher-icon-width) * 3) +
    (var(--switcher-gap) * 2) +
    (var(--switcher-padding-h) * 2)
  );
  height: 3.5rem;
  padding: var(--switcher-padding-v) var(--switcher-padding-h) 0.5rem;
  border-radius: 99em;
  cursor: default;
  transform: scale(1);
}

/* Base switcher styles */
.switcher {
  display: flex;
  align-items: center;
  justify-content: flex-start; /* 默认左对齐 */
  gap: var(--switcher-gap, 0.4rem);
  width: calc(
    (var(--switcher-icon-width, 3.4rem) * 3) +
    (var(--switcher-gap, 0.4rem) * 2) +
    (var(--switcher-padding-h, 0.6rem) * 2)
  );
  max-width: calc(
    (var(--switcher-icon-width, 3.4rem) * 3) +
    (var(--switcher-gap, 0.4rem) * 2) +
    (var(--switcher-padding-h, 0.6rem) * 2)
  );
  height: 3.5rem;
  box-sizing: border-box;
  padding: var(--switcher-padding-v, 0.4rem)
           var(--switcher-padding-h, 0.6rem)
           0.5rem;
  margin: 0 auto;
  border: none;
  border-radius: 99em;
  background-color: color-mix(in srgb, var(--c-glass) 12%, transparent);
  backdrop-filter: blur(8px) url(#switcher) saturate(var(--saturation));
  -webkit-backdrop-filter: blur(8px) saturate(var(--saturation));
  box-shadow: 
    inset 0 0 0 1px color-mix(in srgb, var(--c-light) calc(var(--glass-reflex-light) * 10%), transparent),
    inset 1.8px 3px 0px -2px color-mix(in srgb, var(--c-light) calc(var(--glass-reflex-light) * 90%), transparent), 
    inset -2px -2px 0px -2px color-mix(in srgb, var(--c-light) calc(var(--glass-reflex-light) * 80%), transparent), 
    inset -3px -8px 1px -6px color-mix(in srgb, var(--c-light) calc(var(--glass-reflex-light) * 60%), transparent), 
    inset -0.3px -1px 4px 0px color-mix(in srgb, var(--c-dark) calc(var(--glass-reflex-dark) * 12%), transparent), 
    inset -1.5px 2.5px 0px -2px color-mix(in srgb, var(--c-dark) calc(var(--glass-reflex-dark) * 20%), transparent), 
    inset 0px 3px 4px -2px color-mix(in srgb, var(--c-dark) calc(var(--glass-reflex-dark) * 20%), transparent), 
    inset 2px -6.5px 1px -4px color-mix(in srgb, var(--c-dark) calc(var(--glass-reflex-dark) * 10%), transparent), 
    0px 1px 5px 0px color-mix(in srgb, var(--c-dark) calc(var(--glass-reflex-dark) * 10%), transparent), 
    0px 6px 16px 0px color-mix(in srgb, var(--c-dark) calc(var(--glass-reflex-dark) * 8%), transparent);
  transition: background-color var(--transition-slow) var(--ease-glass),
              box-shadow var(--transition-slow) var(--ease-glass);
}

/* ========================================
   TAB SWITCHER STYLES - 完全隔离
   ======================================== */

.tab-switcher {
  position: relative;
  width: 100%;
  max-width: 28rem;
  height: 3.25rem;
  padding: 0.4rem 0.4rem 0.4rem;
  backdrop-filter: blur(8px) url(#tab-switcher) saturate(var(--saturation));
  -webkit-backdrop-filter: blur(8px) saturate(var(--saturation));
}

.tab-switcher .switcher__option {
  flex: 1;
  padding: 0 1.5rem;
}

.tab-switcher .switcher__option,
.tab-switcher .switcher__icon-wrapper,
.tab-switcher .switcher__label {
  user-select: none;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
}

.tab-switcher .switcher__icon-wrapper {
  display: flex;
  align-items: center;
  gap: 0.6rem;
  width: 100%;
  justify-content: center;
}

.tab-switcher .switcher__icon {
  width: 1.1rem;
  height: 1.1rem;
  transition: color var(--transition-fast) var(--ease-smooth),
              scale var(--transition-fast) var(--ease-smooth);
}

/* Tab switcher hover 动效 - 仅影响 tab-switcher */
.tab-switcher .switcher__option:hover:not(:has(input:checked)) {
  --c: var(--c-action);
  cursor: pointer;
}

.tab-switcher .switcher__option:hover:not(:has(input:checked)) .switcher__icon {
  scale: 1.15;
}

.tab-switcher .switcher__option:hover:not(:has(input:checked)) .switcher__label {
  color: var(--c-action);
}

.tab-switcher .switcher__label {
  transition: color var(--transition-fast);
  pointer-events: none; /* 文字不可被点击，点击事件穿透到父级 label */
}

/* Override the ::after element for tab-switcher - restore sliding effect */
.tab-switcher::after {
  content: '';
  position: absolute;
  display: block;
  width: calc((100% - 0.8rem) / 2);
  left: 0.4rem;
  top: 0.4rem;
  height: calc(100% - 0.8rem);
  border-radius: 99em;
  background-color: color-mix(in srgb, var(--c-glass) 18%, transparent);
  z-index: -1;
  box-sizing: border-box;
  box-shadow: 
    inset 0 0 0 1px color-mix(in srgb, var(--c-light) calc(var(--glass-reflex-light) * 15%), transparent),
    inset 2px 1px 0px -1px color-mix(in srgb, var(--c-light) calc(var(--glass-reflex-light) * 95%), transparent), 
    inset -1.5px -1px 0px -1px color-mix(in srgb, var(--c-light) calc(var(--glass-reflex-light) * 85%), transparent), 
    inset -2px -6px 1px -5px color-mix(in srgb, var(--c-light) calc(var(--glass-reflex-light) * 70%), transparent),
    inset 1px -2px 2px -1px color-mix(in srgb, var(--c-light) calc(var(--glass-reflex-light) * 40%), transparent),
    inset -1px 2px 3px -1px color-mix(in srgb, var(--c-dark) calc(var(--glass-reflex-dark) * 8%), transparent), 
    inset 0px -4px 1px -2px color-mix(in srgb, var(--c-dark) calc(var(--glass-reflex-dark) * 4%), transparent), 
    0px 2px 4px 0px color-mix(in srgb, var(--c-dark) calc(var(--glass-reflex-dark) * 3%), transparent),
    0px 1px 2px 0px color-mix(in srgb, var(--c-light) calc(var(--glass-reflex-light) * 20%), transparent);
  /* Tab switcher 滑块动画 - 使用变量 */
  transition: left var(--transition-slow) var(--ease-smooth),
              translate var(--transition-slow) var(--ease-smooth),
              background-color var(--transition-slow) var(--ease-glass),
              box-shadow var(--transition-slow) var(--ease-glass);
  will-change: left, translate;
}

.switcher__legend {
  position: absolute;
  width: 1px;
  height: 1px;
  margin: -1px;
  border: 0;
  padding: 0;
  white-space: nowrap;
  clip-path: inset(100%);
  clip: rect(0 0 0 0);
  overflow: hidden;
}

.switcher__input {
  clip: rect(0 0 0 0);
  clip-path: inset(100%);
  height: 1px;
  width: 1px;
  overflow: hidden;
  position: absolute;
  white-space: nowrap;
}

.switcher__icon {
  display: block;
  width: 100%;
  /* 通用图标过渡 - theme-switcher 和 tab-switcher 都会继承 */
  transition: color var(--transition-fast) var(--ease-smooth),
              scale var(--transition-fast) var(--ease-smooth);
}

.switcher__filter {
  position: absolute;
  width: 0;
  height: 0;
  z-index: -1;
}

/* 7. 内部选项 (Label) */
.switcher__option {
  --c: var(--c-content);
  display: flex;
  justify-content: center;
  align-items: center;
  box-sizing: border-box;
  overflow: hidden;
  border-radius: 99em;
  z-index: var(--z-content); /* 确保图标在 ::after 滑块之上 */
  position: relative;
  
  /*
    动画 - 通用选项过渡（theme-switcher 使用）
    - 动画 width, opacity, 和 transform
    - transform 实现了从右侧滑入效果
  */
  transition: width var(--transition-base) var(--ease-smooth), 
              opacity var(--transition-fast) var(--ease-smooth),
              transform var(--transition-base) var(--ease-smooth);
  will-change: width, opacity, transform;
}

/* Theme switcher hover 动效 - 完全隔离，不影响 tab-switcher */
.theme-switcher-container .theme-switcher-expanded .switcher__option:hover {
  --c: var(--c-action);
  cursor: pointer;
}

.theme-switcher-container[data-expanded="true"] .theme-switcher-expanded .switcher__option:hover .switcher__icon {
  scale: 1.2;
}

.theme-switcher-container[data-expanded="false"] .theme-switcher-expanded .switcher__option:hover .switcher__icon {
  scale: 1.15; /* 折叠态稍微小一点的缩放 */
}

/* 8. 内部选项 - 展开态 - 仅影响 theme-switcher */
.theme-switcher-container[data-expanded="true"] .theme-switcher-expanded .switcher__option {
  width: var(--switcher-icon-width);
  height: 100%;
  padding: 0 0.8rem;
  opacity: 1;
  /* 
    关键：所有图标都从右侧滑入到中心位置
    匹配展开方向（从右向左）
    - 非激活图标：从 translateX(100%) 滑入到 translateX(0)
    - 激活图标：保持在 translateX(0)
  */
  transform: translateX(0);
  /*
    TIMING:
    - 延迟 100ms，等待容器先展开
  */
  transition-delay: 100ms; 
}

/* 9. 内部选项 - 折叠态 (Default) - 仅影响 theme-switcher */
.theme-switcher-container[data-expanded="false"] .theme-switcher-expanded .switcher__option {
  width: 0;
  height: 3rem; /* Match container */
  padding: 0;
  opacity: 0;
  /*
    关键修复：非激活图标从右侧开始
    匹配展开方向（从右向左展开）
  */
  transform: translateX(100%); 
  /*
    TIMING:
    - 收起时，非激活图标立即 (0ms) 开始淡出和收缩
  */
  transition-duration: 200ms;
  transition-delay: 0ms;
}

/* 10. 折叠态的 *激活* 选项 - 仅影响 theme-switcher */
.theme-switcher-container[data-expanded="false"] .theme-switcher-expanded .switcher__option:has(input:checked) {
  width: 3rem; /* 充满容器 */
  height: 3rem; /* 确保高度匹配 */
  opacity: 1; /* 保持可见 */
  /* 激活图标保持在中心位置，不移动 */
  transform: translateX(0); 
  /* 确保图标完美居中 - 无论哪个theme都居中 */
  display: flex;
  justify-content: center;
  align-items: center;
  padding: 0; /* 无内边距，确保居中 */
  margin: 0; /* 确保无外边距 */
  flex-shrink: 0; /* 防止被压缩 */
  transition-delay: 0ms;
  transition: width var(--transition-base) var(--ease-smooth),
              transform var(--transition-base) var(--ease-smooth),
              opacity 0ms; /* 保持可见，无过渡 */
}

/* 移除通用的 hover，已在上面的展开态中定义 */
.switcher__option:has(input:checked) {
  --c: var(--c-content);
  cursor: auto;
}

.switcher__option:has(input:checked) .switcher__icon {
  scale: 1;
}

/*
  FIX 1: "两层玻璃" (::after)
*/
.switcher::after {
  content: '';
  position: absolute;
  display: block;
  border-radius: 99em;
  background-color: color-mix(in srgb, var(--c-glass) 36%, transparent);
  z-index: var(--z-base); /* 提高 z-index，但在 icon (z-index: var(--z-content)) 之下 */
  backdrop-filter: blur(8px) url(#switcher) saturate(var(--saturation));
  -webkit-backdrop-filter: blur(8px) saturate(var(--saturation));
  box-shadow: 
    inset 0 0 0 1px color-mix(in srgb, var(--c-light) calc(var(--glass-reflex-light) * 10%), transparent),
    inset 2px 1px 0px -1px color-mix(in srgb, var(--c-light) calc(var(--glass-reflex-light) * 90%), transparent), 
    inset -1.5px -1px 0px -1px color-mix(in srgb, var(--c-light) calc(var(--glass-reflex-light) * 80%), transparent), 
    inset -2px -6px 1px -5px color-mix(in srgb, var(--c-light) calc(var(--glass-reflex-light) * 60%), transparent), 
    inset -1px 2px 3px -1px color-mix(in srgb, var(--c-dark) calc(var(--glass-reflex-dark) * 20%), transparent), 
    inset 0px -4px 1px -2px color-mix(in srgb, var(--c-dark) calc(var(--glass-reflex-dark) * 10%), transparent), 
    0px 3px 6px 0px color-mix(in srgb, var(--c-dark) calc(var(--glass-reflex-dark) * 8%), transparent);
  
  /*
    动画:
    - 我们动画所有属性，以实现平滑形变
    - translate 动画是关键，确保滑块从右侧滑入到目标位置
  */
  /* Theme switcher 滑块动画 - 使用变量 */
  transition: width var(--transition-base) var(--ease-smooth),
              height var(--transition-base) var(--ease-smooth),
              translate var(--transition-slow) var(--ease-smooth), /* 平移稍慢，更平滑 */
              opacity var(--transition-fast) var(--ease-smooth),
              backdrop-filter var(--transition-slow) var(--ease-glass);
  will-change: width, height, translate, opacity;
}

/* 12. 滑块 - 折叠态 - 仅影响 theme-switcher */
.theme-switcher-container[data-expanded="false"] .theme-switcher-expanded::after {
  /*
    关键修复：折叠时，滑块完全透明并消失
    这解决了"两层玻璃"问题。
    容器 (fieldset) 本身在折叠时就是那个 3rem 的毛玻璃按钮。
  */
  width: 3rem;
  height: 3rem;
  left: 0;
  top: 0;
  /* 折叠时滑块位置不重要，因为它被隐藏了 */
  translate: 0 0;
  border-radius: 99em;
  opacity: 0; /* 隐藏 */
  visibility: hidden;
  transition-delay: 0ms; /* 立即隐藏 */
}

/* 13. 滑块 - 展开态基础样式 - 仅影响 theme-switcher */
.theme-switcher-container[data-expanded="true"] .theme-switcher-expanded::after {
  width: calc(var(--switcher-icon-width) + 0.8rem);
  height: calc(100% - 0.5rem);
  left: 0.2rem;
  top: 0.2rem;
  border-radius: 99em; /* 保持胶囊形 */
  opacity: 1; /* 出现 */
  visibility: visible;
  /*
    关键修复：展开时滑块从右侧开始滑入
    初始位置设置为右侧边缘（匹配展开方向从右向左）
    容器宽度 12.2rem，padding 0.6rem，所以滑块从右侧边缘滑入
  */
  /* 初始位置：从最右侧开始（对应 option 3 的位置，7.6rem）或更右侧 */
  translate: 11rem 0; /* 从右侧边缘滑入 */
  /*
    TIMING:
    - 延迟 100ms，与图标一起出现
    - translate 动画会平滑过渡到目标位置（由下面的 :has() 规则控制）
  */
  transition-delay: 100ms;
}

/*
  15. 替换为基于 *当前* 选中项的 translate 动画
  关键修复：滑块从右侧滑入到目标位置，匹配展开方向（从右向左）
*/
.theme-switcher-container[data-expanded="true"] .theme-switcher-expanded:has(input[data-option="1"]:checked)::after {
  /* option 1 在左侧，从右侧滑入 */
  translate: 0 0;
}

.theme-switcher-container[data-expanded="true"] .theme-switcher-expanded:has(input[data-option="2"]:checked)::after {
  /* option 2 在中间，从右侧滑入 */
  translate: calc(var(--switcher-icon-width) + var(--switcher-gap)) 0;
}

.theme-switcher-container[data-expanded="true"] .theme-switcher-expanded:has(input[data-option="3"]:checked)::after {
  /* option 3 在右侧，从右侧滑入 */
  translate: calc((var(--switcher-icon-width) + var(--switcher-gap)) * 2) 0;
}

/* Tab switcher 滑块位置动画 - 使用变量 */
.tab-switcher:has(input[data-option="1"]:checked)::after,
.tab-switcher:has(input[data-option="2"]:checked)::after {
  width: calc((100% - 0.8rem) / 2);
  translate: 0 0;
  transition: left var(--transition-slow) var(--ease-smooth),
              width var(--transition-slow) var(--ease-smooth),
              translate var(--transition-slow) var(--ease-smooth),
              background-color var(--transition-slow) var(--ease-glass),
              box-shadow var(--transition-slow) var(--ease-glass);
}

.tab-switcher:has(input[data-option="1"]:checked)::after {
  left: 0.4rem;
  transform-origin: right;
}

.tab-switcher:has(input[data-option="2"]:checked)::after {
  /* 计算右侧 tab 的位置：left = padding + 一个 tab 的宽度 */
  left: calc((100% - 0.8rem) / 2 + 0.4rem);
  transform-origin: left;
}

/* 基于 previous 状态优化动画方向 - 确保从正确方向滑入 */
.tab-switcher[data-previous="1"]:has(input[data-option="2"]:checked)::after {
  transform-origin: left;
}

.tab-switcher[data-previous="2"]:has(input[data-option="1"]:checked)::after {
  transform-origin: right;
}

/* Fade in animation for tags */
@keyframes fadeIn {
  from {
    opacity: 0;
    transform: translateY(-4px) scale(0.95);
  }
  to {
    opacity: 1;
    transform: translateY(0) scale(1);
  }
}

/* Tag animation classes - 只保留进入动画 */
.tag-enter {
  animation: fadeIn 0.3s cubic-bezier(0.4, 0, 0.2, 1) forwards;
}

/* ========================================
   SETTINGS MODAL - 无感设置
   ======================================== */

/* 节标题 (Section Header) - 极度简约，只用于分组 */
.settings-section-title {
  font-size: 0.75rem; /* 12px */
  font-weight: 600; /* Semibold */
  letter-spacing: 0.05em; /* 大写字母间距拉开 */
  text-transform: uppercase;
  color: color-mix(in srgb, var(--c-content) 60%, transparent);
  margin-top: 1.5rem; /* 24px */
  margin-bottom: 0.5rem; /* 8px */
}

/* 第一个节标题不需要上边距 */
.settings-section-title:first-child {
  margin-top: 0;
}

/* 设置项行 (Setting Row) - 清晰、一致，具有明确的交互示能 */
.settings-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  min-height: 44px; /* 确保移动端点击区域 */
  padding: 0.5rem 0;
  cursor: pointer;
  transition: background-color var(--transition-fast) var(--ease-smooth);
  border-radius: 0.5rem;
  padding-left: 0.5rem;
  padding-right: 0.5rem;
  margin-left: -0.5rem;
  margin-right: -0.5rem;
}

.settings-row:hover {
  background-color: color-mix(in srgb, var(--c-glass) 8%, transparent);
}

.settings-row-label {
  font-size: 0.9rem; /* 14-15px */
  font-weight: 500; /* Medium */
  color: var(--c-content);
  user-select: none;
}

.settings-row-button {
  display: flex;
  justify-content: space-between;
  align-items: center;
  width: 100%;
  min-height: 44px;
  padding: 0.5rem 0.75rem;
  background: transparent;
  border: none;
  border-radius: 0.5rem;
  font-size: 0.9rem;
  font-weight: 500;
  color: var(--c-content);
  cursor: pointer;
  transition: background-color var(--transition-fast) var(--ease-smooth),
              color var(--transition-fast) var(--ease-smooth);
  text-align: left;
}

.settings-row-button:hover {
  background-color: color-mix(in srgb, var(--c-glass) 8%, transparent);
  color: var(--c-action);
}

/* ========================================
   STATS WALL MODAL - 像素画廊
   ======================================== */

/* 像素画廊 (Stats Wall) 样式
 * 适配 Light / Dark / Dim 主题
 */
.stats-wall-backdrop {
  position: fixed;
  inset: 0;
  z-index: var(--z-modal-layer);
  display: flex;
  align-items: center;
  justify-content: center;
  
  /* 使用半透明背景，确保可见性 */
  background: color-mix(in srgb, var(--c-dark) 40%, transparent);
  backdrop-filter: blur(8px);
  
  /* 确保这个 modal 可以滚动，如果内容溢出 */
  overflow-y: auto;
  padding: 1rem;
}

.stats-wall-container {
  width: 100%;
  max-width: 560px; /* [V-Mod] 原为 420px，显著增大宽度 */
  /* [V-Mod] 显著增大垂直和水平 padding，增加呼吸感 */
  padding: 1.25rem 1.5rem; /* 原为 1rem 1.25rem (即 20px 垂直, 24px 水平) */
  margin: auto;
  background-color: color-mix(in srgb, var(--c-bg) 98%, transparent) !important;
  backdrop-filter: blur(16px) saturate(180%) !important;
  border: 1px solid color-mix(in srgb, var(--c-light) calc(var(--glass-reflex-light) * 30%), transparent);
  box-shadow: 0px 8px 32px color-mix(in srgb, var(--c-dark) 30%, transparent);

  /* [V4] 确保 GlassCard 内部布局正确 */
  display: flex;
  flex-direction: column;
  max-height: 90vh; /* 防止模态框过高 */
}
.stats-wall-container .liquidGlass-content {
  /* [V7] 确保内容可以 flex 布局 */
  display: flex;
  flex-direction: column;
  flex: 1; /* 占据剩余空间 */
  min-height: 0; /* 允许子元素滚动 */
  width: auto; 
  min-width: 0;
}

.stats-wall-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 1rem;
  flex-shrink: 0; /* 不收缩 */
}

.stats-wall-title {
  font-size: 1.25rem;
  font-weight: 700;
  color: var(--c-content);
  margin: 0;
}

.close-button {
  /* 复用 GlassButton 的一些样式，但更轻量 */
  padding: 0.5rem;
  border-radius: 99em;
  background: color-mix(in srgb, var(--c-glass) 15%, transparent);
  color: var(--c-content);
  border: none;
  cursor: pointer;
  transition: all 150ms var(--ease-smooth, ease-out);
}

.close-button:hover {
  background: color-mix(in srgb, var(--c-action) 20%, transparent);
  color: var(--c-action);
}


/* ========================================
   ACTIVITY CALENDAR - 日历热图 (V12: 安全缓冲区布局)
   ======================================== */

.stats-wall-calendar-layout {
  /* --- [核心变量配置] --- */
  /* 1. Tile 尺寸 */
  --square-size: 24px;   
  --gap-size: 4px;       
  
  /* 2. 布局尺寸 */
  --day-label-width: 30px; 
  
  /* 3. 头部高度 (月份标签高度 + 它的下边距) */
  --month-label-height: 1rem; 
  --month-label-margin: 6px;
  
  /* 4. [新增] 安全缓冲区 (Padding)
     Tile 24px * 1.15 (scale) ≈ 27.6px -> 每边溢出 ~1.8px
     Shadow 扩散 ≈ 8px
     因此我们需要至少 10px 的 padding 来防止 hover 被切断
  */
  --grid-safe-padding: 10px;

  /* 5. [自动计算] 顶部对齐偏移量
     左侧星期标签的 padding-top 必须等于：
     (右侧容器内 padding-top) + (月份标签总高度)
  */
  --header-offset: calc(var(--grid-safe-padding) + var(--month-label-height) + var(--month-label-margin));

  display: grid;
  /* Col 1: 固定星期标签, Col 2: 滚动内容 */
  grid-template-columns: var(--day-label-width) 1fr;
  grid-template-rows: 1fr;
  /* 减小列间距，因为右侧现在有了 padding-left，视觉上会增加间距 */
  gap: 0px; 
  
  flex: 1;
  min-height: 0;
  /* 移除旧的 padding-top，现在由内部 padding 控制 */
  padding-top: 0; 
}

/* [左侧] 固定的星期标签 (M, W, F) */
.day-labels-fixed {
  /* [关键修复] 使用计算出的偏移量，确保与右侧 Grid 的第一行严格对齐 */
  padding-top: var(--header-offset);
  
  /* [新增] 左侧加一点 padding 以防 scale 溢出左边界 (虽然 Label 不缩放，但为了对称美观) */
  padding-left: 4px;
  
  display: grid;
  grid-template-rows: repeat(7, var(--square-size));
  gap: var(--gap-size);

  font-size: 0.6rem;
  font-weight: 500;
  color: color-mix(in srgb, var(--c-content) 50%, transparent);
  
  align-items: center;
  justify-items: start;
}

/* Grid Index: 1=Sun, 2=Mon, 3=Tue, 4=Wed, 5=Thu, 6=Fri, 7=Sat */
.day-labels-fixed span:nth-child(1) { grid-row: 2; } /* Mon */
.day-labels-fixed span:nth-child(2) { grid-row: 4; } /* Wed */
.day-labels-fixed span:nth-child(3) { grid-row: 6; } /* Fri */



/* [右侧] 可滚动的内容区域 */
.stats-wall-scroll-content {
  overflow-x: auto;
  overflow-y: hidden; /* 保持 hidden 防止垂直滚动条 */
  
  /* [关键修复] 添加四周内边距，作为 hover 缩放的安全缓冲区 */
  padding: var(--grid-safe-padding);
  
  min-width: 0;
  scrollbar-width: thin;
  scrollbar-color: color-mix(in srgb, var(--c-glass) 40%, transparent) color-mix(in srgb, var(--c-glass) 10%, transparent);
}

/* [右侧内部] 月份标签 */
.month-labels {
  display: grid;
  grid-auto-flow: column;
  gap: var(--gap-size);
  
  height: var(--month-label-height);
  margin-bottom: var(--month-label-margin);
  
  /* [新增] 简单的 z-index 提升，防止被下方 grid hover 时遮挡 (虽然主要靠 padding) */
  position: relative;
  z-index: var(--z-base);
}

.month-labels span {
  font-size: 0.6rem;
  font-weight: 500;
  color: color-mix(in srgb, var(--c-content) 50%, transparent);
  white-space: nowrap; 
  display: flex;
  align-items: end;
  line-height: 1;
  overflow: hidden;
}

/* [右侧内部] 核心热图网格 */
.activity-grid {
  display: grid;
  grid-template-rows: repeat(7, var(--square-size));
  grid-auto-flow: column;
  gap: var(--gap-size);
  
  /* 确保 grid 本身也有层级上下文 */
  position: relative;
}

/* 9. 活动方块 (V9 修复：添加背景色过渡) */
.activity-day-square {
  width: var(--square-size);
  height: var(--square-size);
  /* [V-Mod] 增大 Tile 圆角以匹配 24px 尺寸 */
  border-radius: 4px; /* 原为 3px */
  cursor: default;
  transition: transform 100ms ease-out, box-shadow 100ms ease-out, background-color 300ms ease-out; /* [V9] 增加背景色过渡 */
}

/* data-level 颜色 */
.activity-day-square[data-level="0"] {
  background: color-mix(in srgb, var(--c-glass) 15%, transparent);
}
.activity-day-square[data-level="1"] {
  background: color-mix(in srgb, var(--c-action) 30%, transparent);
}
.activity-day-square[data-level="2"] {
  background: color-mix(in srgb, var(--c-action) 60%, transparent);
}
.activity-day-square[data-level="3"] {
  background: color-mix(in srgb, var(--c-action) 100%, transparent);
}
.activity-day-square:hover {
  transform: scale(1.15);
  position: relative;
  z-index: var(--z-sticky);
  box-shadow: 0 2px 8px color-mix(in srgb, var(--c-dark) 20%, transparent);
}

/* [修改] 7. 图例 (现在是固定在底部的 .calendar-legend-fixed) */
.calendar-legend-fixed {
  /* [移除] grid-column 和 grid-row */
  
  display: flex;
  justify-content: flex-end;
  align-items: center;
  gap: 4px;
  font-size: 0.7rem;
  color: color-mix(in srgb, var(--c-content) 60%, transparent);
  margin-top: 0.5rem; /* 调整与上方布局的间距 */
  padding-right: 2px;
  flex-shrink: 0; /* 确保在 flex 布局中不被压缩 */
}
.calendar-legend-fixed .legend-square {
  width: 10px;
  height: 10px;
  border-radius: 2px;
}

/* data-level 样式 */
.calendar-legend-fixed .legend-square[data-level="0"] {
  background: color-mix(in srgb, var(--c-glass) 15%, transparent);
}
.calendar-legend-fixed .legend-square[data-level="1"] {
  background: color-mix(in srgb, var(--c-action) 30%, transparent);
}
.calendar-legend-fixed .legend-square[data-level="2"] {
  background: color-mix(in srgb, var(--c-action) 60%, transparent);
}
.calendar-legend-fixed .legend-square[data-level="3"] {
  background: color-mix(in srgb, var(--c-action) 100%, transparent);
}

/* [V9 修复] 移除 .stats-wall-message-center (不再需要加载/错误状态) */

/* ========================================
   ACTIVITY GROUP TITLE - 粘性标题
   ======================================== */

.activity-group-title {
  font-size: 0.7rem;
  font-weight: 600;
  letter-spacing: 0.05em;
  text-transform: uppercase;
  color: color-mix(in srgb, var(--c-content) 50%, transparent);
  border-bottom: 1px solid color-mix(in srgb, var(--c-glass) 15%, transparent);

  /* --- [NEW] --- */
  
  /* 1. 将其变为粘性标题 */
  position: sticky;
  top: 0;
  
  /* 2. 确保它在滚动内容之上 */
  z-index: var(--z-sticky);
  
  /* 3. 必须添加背景色，以覆盖下方滚动的内容 */
  /* 匹配 .stats-wall-container 的背景色 */
  background-color: color-mix(in srgb, var(--c-bg) 98%, transparent);
  
  /* 4. 调整 Padding，使其在粘性状态下更好看 */
  padding: 0.5rem; /* 替换: padding: 0 0.5rem 0.5rem 0.5rem; */
}

/* ========================================
   CHANNEL TITLE - 流光渐变效果
   ======================================== */

.channel-title-wrapper {
  position: relative;
  /* 我们使用 wrapper 来应用 hover，这样 shimmer 效果更灵敏 */
}

.channel-title {
  position: relative;
  display: inline-block;
  font-size: 0.9rem; /* 14.4px */
  font-weight: 700;
  letter-spacing: -0.01em;

  /* 1. 创建渐变文本 */
  background: linear-gradient(
    90deg, 
    var(--c-action) 0%, 
    color-mix(in srgb, var(--c-content) 90%, transparent) 80%
  );
  -webkit-background-clip: text;
  background-clip: text;
  color: transparent;

  /* 2. 准备流光效果 */
  overflow: hidden;
  cursor: default;
  user-select: none;
}

.channel-title::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;

  /* 3. 这是流光（高光） */
  background: linear-gradient(
    90deg, 
    transparent 0%, 
    color-mix(in srgb, var(--c-light) 60%, transparent) 50%, 
    transparent 100%
  );

  opacity: 0.8;

  /* 4. 初始状态（在左侧屏幕外） */
  transform: translateX(-120%);
  transition: transform 0.7s cubic-bezier(0.25, 1, 0.5, 1);
}

/* 5. Hover 状态（在 wrapper 上触发） */
.channel-title-wrapper:hover .channel-title::before {
  transform: translateX(120%);
}

/* [新增] 辅助类，用于隐藏 h2 上强制的滚动条 */
h2[style*="overflow-y: scroll"]::-webkit-scrollbar {
  display: var(--pseudo-display, block);
}

/* ========================================
   [新增] HOVER UTILITY SYSTEM
   ======================================== */

/* 规则 A: "选中" (Glass)
   用于 SettingsRow, TagRow 等容器
*/
.hover-glass {
  background-color: transparent;
  border-color: transparent;
  transition: background-color var(--transition-fast) var(--ease-smooth),
              border-color var(--transition-fast) var(--ease-smooth);
}

.hover-glass:hover {
  background-color: var(--hover-bg-glass) !important;
  /* border-color: var(--hover-border-glass) !important; */
}

/* 规则 B: "行动" (Action)
   用于按钮、图标、菜单项
*/
.hover-action {
  background-color: transparent;
  color: var(--c-content);
  transition: background-color var(--transition-fast) var(--ease-smooth),
              color var(--transition-fast) var(--ease-smooth);
}

.hover-action:hover {
  background-color: var(--hover-bg-action) !important;
  color: var(--hover-color-action) !important;
}

.hover-action:hover svg {
  color: var(--hover-color-action) !important;
}

/* --- [新增] DESTRUCTIVE HOVER UTILITY --- */

/* 规则 C: "毁灭性行动" (Destructive)
   用于所有非 GlassButton 的删除按钮
*/
.hover-destructive {
  background-color: transparent;
  color: color-mix(in srgb, var(--c-content) 60%, transparent);
  transition: background-color var(--transition-fast) var(--ease-smooth),
              color var(--transition-fast) var(--ease-smooth);
}

.hover-destructive:hover {
  background-color: var(--hover-bg-action) !important;
  color: var(--hover-color-destructive) !important;
}

.hover-destructive:hover svg {
  color: var(--hover-color-destructive) !important;
}