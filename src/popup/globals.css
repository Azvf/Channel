@import url('https://fonts.googleapis.com/css2?family=DM+Sans:opsz,wght@9..40,100..1000&display=swap');

/* @custom-variant dark (&:is(.dark *)); */

@layer base {
  /* * {
    @apply border-border outline-ring/50;
  } */

  body {
    --c-glass: #bbbbbc;
    --c-light: #fff;
    --c-dark: #000;
    
    --c-content: #224;
    --c-action: #0052f5;
    
    --c-bg: #E8E8E9;
    
    --glass-reflex-dark: 1;
    --glass-reflex-light: 1;
    
    --saturation: 150%;
    
    /* 动画时间变量 */
    --transition-fast: 200ms;
    --transition-base: 300ms;
    --transition-slow: 400ms;
    
    /* 缓动函数变量 */
    --ease-smooth: cubic-bezier(0.4, 0, 0.2, 1);
    --ease-glass: cubic-bezier(1, 0.0, 0.4, 1);
    
    font-size: 20px;
    font-family: "DM Sans", sans-serif;
    font-optical-sizing: auto;
    background: var(--c-bg);
    color: var(--c-content);
    
    /* 默认禁用过渡，避免主题切换时的闪烁 */
    /* transition 将在 JavaScript 中通过 data-theme-ready 属性启用 */
    transition: none;
  }
  
  /* 只有当 body 有 data-theme-ready 属性时才启用过渡效果 */
  body[data-theme-ready] {
    transition: background var(--transition-slow) var(--ease-glass), 
                color var(--transition-slow) var(--ease-glass);
  }
  
  /* 如果 body 上有 data-theme-no-transition，强制禁用过渡 */
  body[data-theme-no-transition] {
    transition: none !important;
  }

  body:has(input[value="dark"]:checked),
  body:has(input[name="theme-persist"][value="dark"]:checked) {
    --c-glass: #bbbbbc;
    --c-light: #fff;
    --c-dark: #000;
    
    --c-content: #e1e1e1;
    --c-action: #03d5ff;
    
    --c-bg: #1b1b1d;
    
    --glass-reflex-dark: 2;
    --glass-reflex-light: 0.3;
    
    --saturation: 150%;
  }

  body:has(input[value="dim"]:checked),
  body:has(input[name="theme-persist"][value="dim"]:checked) {
    --c-light: #99deff;
    --c-dark: #20001b;
    --c-glass: hsl(335 250% 74% / 1);
    
    --c-content: #d5dbe2;
    --c-action: #ff48a9;
    
    --c-bg: #152433;
    
    --glass-reflex-dark: 2;
    --glass-reflex-light: 0.7;
    
    --saturation: 200%;
  }
}

:root {
  --font-size: 20px;
  --background: #ffffff;
  --foreground: oklch(0.145 0 0);
  --card: #ffffff;
  --card-foreground: oklch(0.145 0 0);
  --popover: oklch(1 0 0);
  --popover-foreground: oklch(0.145 0 0);
  --primary: #030213;
  --primary-foreground: oklch(1 0 0);
  --secondary: oklch(0.95 0.0058 264.53);
  --secondary-foreground: #030213;
  --muted: #ececf0;
  --muted-foreground: #717182;
  --accent: #e9ebef;
  --accent-foreground: #030213;
  --destructive: #d4183d;
  --destructive-foreground: #ffffff;
  --border: rgba(0, 0, 0, 0.1);
  --input: transparent;
  --input-background: #f3f3f5;
  --switch-background: #cbced4;
  --font-weight-medium: 500;
  --font-weight-normal: 400;
  --ring: oklch(0.708 0 0);
  --chart-1: oklch(0.646 0.222 41.116);
  --chart-2: oklch(0.6 0.118 184.704);
  --chart-3: oklch(0.398 0.07 227.392);
  --chart-4: oklch(0.828 0.189 84.429);
  --chart-5: oklch(0.769 0.188 70.08);
  --radius: 0.625rem;
  --sidebar: oklch(0.985 0 0);
  --sidebar-foreground: oklch(0.145 0 0);
  --sidebar-primary: #030213;
  --sidebar-primary-foreground: oklch(0.985 0 0);
  --sidebar-accent: oklch(0.97 0 0);
  --sidebar-accent-foreground: oklch(0.205 0 0);
  --sidebar-border: oklch(0.922 0 0);
  --sidebar-ring: oklch(0.708 0 0);
}

.dark {
  --background: oklch(0.145 0 0);
  --foreground: oklch(0.985 0 0);
  --card: oklch(0.145 0 0);
  --card-foreground: oklch(0.985 0 0);
  --popover: oklch(0.145 0 0);
  --popover-foreground: oklch(0.985 0 0);
  --primary: oklch(0.985 0 0);
  --primary-foreground: oklch(0.205 0 0);
  --secondary: oklch(0.269 0 0);
  --secondary-foreground: oklch(0.985 0 0);
  --muted: oklch(0.269 0 0);
  --muted-foreground: oklch(0.708 0 0);
  --accent: oklch(0.269 0 0);
  --accent-foreground: oklch(0.985 0 0);
  --destructive: oklch(0.396 0.141 25.723);
  --destructive-foreground: oklch(0.637 0.237 25.331);
  --border: oklch(0.269 0 0);
  --input: oklch(0.269 0 0);
  --ring: oklch(0.439 0 0);
  --font-weight-medium: 500;
  --font-weight-normal: 400;
  --chart-1: oklch(0.488 0.243 264.376);
  --chart-2: oklch(0.696 0.17 162.48);
  --chart-3: oklch(0.769 0.188 70.08);
  --chart-4: oklch(0.627 0.265 303.9);
  --chart-5: oklch(0.645 0.246 16.439);
  --sidebar: oklch(0.205 0 0);
  --sidebar-foreground: oklch(0.985 0 0);
  --sidebar-primary: oklch(0.488 0.243 264.376);
  --sidebar-primary-foreground: oklch(0.985 0 0);
  --sidebar-accent: oklch(0.269 0 0);
  --sidebar-accent-foreground: oklch(0.985 0 0);
  --sidebar-border: oklch(0.269 0 0);
  --sidebar-ring: oklch(0.439 0 0);
}

/* Theme variables mapping */
:root {
  --color-background: var(--background);
  --color-foreground: var(--foreground);
  --color-card: var(--card);
  --color-card-foreground: var(--card-foreground);
  --color-popover: var(--popover);
  --color-popover-foreground: var(--popover-foreground);
  --color-primary: var(--primary);
  --color-primary-foreground: var(--primary-foreground);
  --color-secondary: var(--secondary);
  --color-secondary-foreground: var(--secondary-foreground);
  --color-muted: var(--muted);
  --color-muted-foreground: var(--muted-foreground);
  --color-accent: var(--accent);
  --color-accent-foreground: var(--accent-foreground);
  --color-destructive: var(--destructive);
  --color-destructive-foreground: var(--destructive-foreground);
  --color-border: var(--border);
  --color-input: var(--input);
  --color-input-background: var(--input-background);
  --color-switch-background: var(--switch-background);
  --color-ring: var(--ring);
  --color-chart-1: var(--chart-1);
  --color-chart-2: var(--chart-2);
  --color-chart-3: var(--chart-3);
  --color-chart-4: var(--chart-4);
  --color-chart-5: var(--chart-5);
  --radius-sm: calc(var(--radius) - 4px);
  --radius-md: calc(var(--radius) - 2px);
  --radius-lg: var(--radius);
  --radius-xl: calc(var(--radius) + 4px);
  --color-sidebar: var(--sidebar);
  --color-sidebar-foreground: var(--sidebar-foreground);
  --color-sidebar-primary: var(--sidebar-primary);
  --color-sidebar-primary-foreground: var(--sidebar-primary-foreground);
  --color-sidebar-accent: var(--sidebar-accent);
  --color-sidebar-accent-foreground: var(--sidebar-accent-foreground);
  --color-sidebar-border: var(--sidebar-border);
  --color-sidebar-ring: var(--sidebar-ring);
}

/**
 * Base typography. This is not applied to elements which have an ancestor with a Tailwind text class.
 */
@layer base {
  :where(:not(:has([class*=" text-"]), :not(:has([class^="text-"])))) {
    :is(h1) {
      font-size: var(--text-2xl);
      font-weight: var(--font-weight-medium);
      line-height: 1.5;
    }

    :is(h2) {
      font-size: var(--text-xl);
      font-weight: var(--font-weight-medium);
      line-height: 1.5;
    }

    :is(h3) {
      font-size: var(--text-lg);
      font-weight: var(--font-weight-medium);
      line-height: 1.5;
    }

    :is(h4) {
      font-size: var(--text-base);
      font-weight: var(--font-weight-medium);
      line-height: 1.5;
    }

    :is(p) {
      font-size: var(--text-base);
      font-weight: var(--font-weight-normal);
      line-height: 1.5;
    }

    :is(label) {
      font-size: var(--text-base);
      font-weight: var(--font-weight-medium);
      line-height: 1.5;
    }

    :is(button) {
      font-size: var(--text-base);
      font-weight: var(--font-weight-medium);
      line-height: 1.5;
    }

    :is(input) {
      font-size: var(--text-base);
      font-weight: var(--font-weight-normal);
      line-height: 1.5;
    }
  }
}

html {
  font-size: var(--font-size);
  scroll-behavior: smooth;
  /* Always show scrollbar to prevent layout shift */
  overflow-y: scroll;
}

/* Optimize backdrop-filter rendering */
[class*="backdrop-blur"],
.liquidGlass-effect {
  transform: translateZ(0);
  -webkit-font-smoothing: antialiased;
  -webkit-backface-visibility: hidden;
  backface-visibility: hidden;
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 12px;
}

::-webkit-scrollbar-track {
  background: color-mix(in srgb, var(--c-glass) 8%, transparent);
}

::-webkit-scrollbar-thumb {
  background: color-mix(in srgb, var(--c-glass) 24%, transparent);
  border-radius: 99em;
  border: 2px solid transparent;
  background-clip: content-box;
}

::-webkit-scrollbar-thumb:hover {
  background: color-mix(in srgb, var(--c-action) 40%, transparent);
  background-clip: content-box;
}

/* Firefox scrollbar */
* {
  scrollbar-width: thin;
  scrollbar-color: color-mix(in srgb, var(--c-glass) 24%, transparent) color-mix(in srgb, var(--c-glass) 8%, transparent);
}

/* Selection color */
::selection {
  background-color: color-mix(in srgb, var(--c-action) 30%, transparent);
  color: var(--c-content);
}

/* ========================================
   UTILITY CLASSES - 可复用样式
   ======================================== */

/* 防止选中文本 - 可复用类 */
.no-select {
  user-select: none;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
}

/* 可复用的过渡动画 */
.transition-smooth {
  transition: color var(--transition-fast) var(--ease-smooth),
              scale var(--transition-fast) var(--ease-smooth);
}

.transition-glass {
  transition: background-color var(--transition-slow) var(--ease-glass),
              box-shadow var(--transition-slow) var(--ease-glass);
}

/* ========================================
   PREMIUM GLASS EFFECT STYLES
   Based on switcher design system
   ======================================== */

.liquidGlass-wrapper {
  position: relative;
  display: flex;
  overflow: hidden;
  isolation: isolate;
  border-radius: 1.4em;
  background-color: color-mix(in srgb, var(--c-glass) 12%, transparent);
  backdrop-filter: blur(8px) saturate(var(--saturation));
  -webkit-backdrop-filter: blur(8px) saturate(var(--saturation));
  box-shadow: 
    inset 0 0 0 1px color-mix(in srgb, var(--c-light) calc(var(--glass-reflex-light) * 10%), transparent),
    inset 1.8px 3px 0px -2px color-mix(in srgb, var(--c-light) calc(var(--glass-reflex-light) * 90%), transparent), 
    inset -2px -2px 0px -2px color-mix(in srgb, var(--c-light) calc(var(--glass-reflex-light) * 80%), transparent), 
    inset -3px -8px 1px -6px color-mix(in srgb, var(--c-light) calc(var(--glass-reflex-light) * 60%), transparent), 
    inset -0.3px -1px 4px 0px color-mix(in srgb, var(--c-dark) calc(var(--glass-reflex-dark) * 12%), transparent), 
    inset -1.5px 2.5px 0px -2px color-mix(in srgb, var(--c-dark) calc(var(--glass-reflex-dark) * 20%), transparent), 
    inset 0px 3px 4px -2px color-mix(in srgb, var(--c-dark) calc(var(--glass-reflex-dark) * 20%), transparent), 
    inset 2px -6.5px 1px -4px color-mix(in srgb, var(--c-dark) calc(var(--glass-reflex-dark) * 10%), transparent), 
    0px 1px 5px 0px color-mix(in srgb, var(--c-dark) calc(var(--glass-reflex-dark) * 10%), transparent), 
    0px 6px 16px 0px color-mix(in srgb, var(--c-dark) calc(var(--glass-reflex-dark) * 8%), transparent);
  transition: background-color var(--transition-slow) var(--ease-glass),
              box-shadow var(--transition-slow) var(--ease-glass);
}

.liquidGlass-content {
  position: relative;
  z-index: 1;
  width: 100%;
}

/* Glass button style */
.glass-button {
  position: relative;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  padding: 0.6em 1.2em;
  border-radius: 99em;
  background-color: color-mix(in srgb, var(--c-glass) 36%, transparent);
  border: none;
  color: var(--c-content);
  cursor: pointer;
  font-family: inherit;
  font-size: inherit;
  font-weight: 400;
  box-shadow: 
    inset 0 0 0 1px color-mix(in srgb, var(--c-light) calc(var(--glass-reflex-light) * 10%), transparent),
    inset 2px 1px 0px -1px color-mix(in srgb, var(--c-light) calc(var(--glass-reflex-light) * 90%), transparent), 
    inset -1.5px -1px 0px -1px color-mix(in srgb, var(--c-light) calc(var(--glass-reflex-light) * 80%), transparent), 
    inset -2px -6px 1px -5px color-mix(in srgb, var(--c-light) calc(var(--glass-reflex-light) * 60%), transparent), 
    inset -1px 2px 3px -1px color-mix(in srgb, var(--c-dark) calc(var(--glass-reflex-dark) * 20%), transparent), 
    inset 0px -4px 1px -2px color-mix(in srgb, var(--c-dark) calc(var(--glass-reflex-dark) * 10%), transparent), 
    0px 3px 6px 0px color-mix(in srgb, var(--c-dark) calc(var(--glass-reflex-dark) * 8%), transparent);
  transition: all var(--transition-fast) var(--ease-smooth);
}

.glass-button:hover {
  color: var(--c-action);
  transform: scale(1.05);
}

.glass-button:active {
  transform: scale(0.98);
}

.glass-button.primary {
  background-color: color-mix(in srgb, var(--c-action) 80%, transparent);
  color: var(--c-light);
}

.glass-button.primary:hover {
  background-color: var(--c-action);
}

/* SVG Filter for Glass Distortion */
.glass-filter {
  position: absolute;
  width: 0;
  height: 0;
  z-index: -1;
}

/* ========================================
   THEME SWITCHER STYLES
   ======================================== */

/* Hidden theme switcher container */
.theme-switcher-container {
  position: fixed;
  bottom: 2rem;
  right: 2rem;
  z-index: 1000;
  transform-origin: bottom right; /* 动画基点 */
}

/* 当对话框打开时隐藏 theme switcher */
body[data-edit-dialog-open] .theme-switcher-container {
  display: none;
}

/* 3. 背景遮罩 (Backdrop) */
.theme-switcher-backdrop {
  position: fixed;
  inset: 0;
  background: transparent;
  z-index: 1000; /* 在 Switcher 后面 */
  pointer-events: none;
  opacity: 0;
  /* 使用更平滑的 'ease-out' 曲线，持续 300ms
     使用 'will-change' 提示浏览器为 opacity 创建合成层 
  */
  transition: opacity var(--transition-base) var(--ease-smooth);
  will-change: opacity;
}

.theme-switcher-container[data-expanded="true"] .theme-switcher-backdrop {
  pointer-events: auto;
  opacity: 1;
}

/* 4. 主体 (Fieldset) */
.theme-switcher-expanded {
  position: absolute;
  bottom: 0;
  right: 0;
  display: flex;
  overflow: hidden;
  z-index: 1001; /* 在 Backdrop 上面 */
  transform-origin: bottom right;
  will-change: width, height, padding, transform;

  /*
    动画:
    - 统一使用 'ease-in-out' 曲线
    - 统一使用 300ms 持续时间
    - transform 动画用于 :hover 效果 (200ms)
  */
  transition: width var(--transition-base) var(--ease-smooth),
              height var(--transition-base) var(--ease-smooth),
              padding var(--transition-base) var(--ease-smooth),
              transform var(--transition-fast) var(--ease-smooth);
  
  /* 移除可能冲突的 margin，因为使用 absolute 定位 */
  margin: 0;
}

/* 5. 主体 - 折叠态 (Collapsed) */
.theme-switcher-container[data-expanded="false"] .theme-switcher-expanded {
  width: 3rem;
  height: 3rem;
  padding: 0;
  border-radius: 99em; /* Force circle */
  cursor: pointer;
  transform: scale(1);
  /* 在折叠态，使用 justify-content: center 确保激活选项居中 */
  justify-content: center;
  gap: 0;
  /* 确保 hover 过渡平滑 */
  transition: width var(--transition-base) var(--ease-smooth),
              height var(--transition-base) var(--ease-smooth),
              padding var(--transition-base) var(--ease-smooth),
              transform var(--transition-fast) var(--ease-smooth),
              gap var(--transition-base) var(--ease-smooth),
              justify-content var(--transition-base); /* 平滑过渡对齐方式 */
}

/* 折叠态的 :hover 效果 */
.theme-switcher-container[data-expanded="false"] .theme-switcher-expanded:hover {
  transform: scale(1.1); /* 悬停时轻微放大 */
}

/* 6. 主体 - 展开态 (Expanded) */
.theme-switcher-container[data-expanded="true"] .theme-switcher-expanded {
  width: 12.2rem;
  height: 3.5rem;
  padding: 0.4rem 0.6rem 0.5rem;
  border-radius: 99em;
  cursor: default;
  transform: scale(1);
}

/* Base switcher styles */
.switcher {
  display: flex;
  align-items: center;
  justify-content: flex-start; /* 默认左对齐 */
  gap: 0.4rem;
  width: 12.2rem;
  max-width: 12.2rem;
  height: 3.5rem;
  box-sizing: border-box;
  padding: 0.4rem 0.6rem 0.5rem;
  margin: 0 auto;
  border: none;
  border-radius: 99em;
  background-color: color-mix(in srgb, var(--c-glass) 12%, transparent);
  backdrop-filter: blur(8px) url(#switcher) saturate(var(--saturation));
  -webkit-backdrop-filter: blur(8px) saturate(var(--saturation));
  box-shadow: 
    inset 0 0 0 1px color-mix(in srgb, var(--c-light) calc(var(--glass-reflex-light) * 10%), transparent),
    inset 1.8px 3px 0px -2px color-mix(in srgb, var(--c-light) calc(var(--glass-reflex-light) * 90%), transparent), 
    inset -2px -2px 0px -2px color-mix(in srgb, var(--c-light) calc(var(--glass-reflex-light) * 80%), transparent), 
    inset -3px -8px 1px -6px color-mix(in srgb, var(--c-light) calc(var(--glass-reflex-light) * 60%), transparent), 
    inset -0.3px -1px 4px 0px color-mix(in srgb, var(--c-dark) calc(var(--glass-reflex-dark) * 12%), transparent), 
    inset -1.5px 2.5px 0px -2px color-mix(in srgb, var(--c-dark) calc(var(--glass-reflex-dark) * 20%), transparent), 
    inset 0px 3px 4px -2px color-mix(in srgb, var(--c-dark) calc(var(--glass-reflex-dark) * 20%), transparent), 
    inset 2px -6.5px 1px -4px color-mix(in srgb, var(--c-dark) calc(var(--glass-reflex-dark) * 10%), transparent), 
    0px 1px 5px 0px color-mix(in srgb, var(--c-dark) calc(var(--glass-reflex-dark) * 10%), transparent), 
    0px 6px 16px 0px color-mix(in srgb, var(--c-dark) calc(var(--glass-reflex-dark) * 8%), transparent);
  transition: background-color var(--transition-slow) var(--ease-glass),
              box-shadow var(--transition-slow) var(--ease-glass);
}

/* ========================================
   TAB SWITCHER STYLES - 完全隔离
   ======================================== */

.tab-switcher {
  position: relative;
  width: 100%;
  max-width: 28rem;
  height: 3.25rem;
  padding: 0.4rem 0.4rem 0.4rem;
  backdrop-filter: blur(8px) url(#tab-switcher) saturate(var(--saturation));
  -webkit-backdrop-filter: blur(8px) saturate(var(--saturation));
}

.tab-switcher .switcher__option {
  flex: 1;
  padding: 0 1.5rem;
}

.tab-switcher .switcher__option,
.tab-switcher .switcher__icon-wrapper,
.tab-switcher .switcher__label {
  user-select: none;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
}

.tab-switcher .switcher__icon-wrapper {
  display: flex;
  align-items: center;
  gap: 0.6rem;
  width: 100%;
  justify-content: center;
}

.tab-switcher .switcher__icon {
  width: 1.1rem;
  height: 1.1rem;
  transition: color var(--transition-fast) var(--ease-smooth),
              scale var(--transition-fast) var(--ease-smooth);
}

/* Tab switcher hover 动效 - 仅影响 tab-switcher */
.tab-switcher .switcher__option:hover:not(:has(input:checked)) {
  --c: var(--c-action);
  cursor: pointer;
}

.tab-switcher .switcher__option:hover:not(:has(input:checked)) .switcher__icon {
  scale: 1.15;
}

.tab-switcher .switcher__option:hover:not(:has(input:checked)) .switcher__label {
  color: var(--c-action);
}

.tab-switcher .switcher__label {
  transition: color var(--transition-fast);
  pointer-events: none; /* 文字不可被点击，点击事件穿透到父级 label */
}

/* Override the ::after element for tab-switcher - restore sliding effect */
.tab-switcher::after {
  content: '';
  position: absolute;
  display: block;
  width: calc((100% - 0.8rem) / 2);
  left: 0.4rem;
  top: 0.4rem;
  height: calc(100% - 0.8rem);
  border-radius: 99em;
  background-color: color-mix(in srgb, var(--c-glass) 18%, transparent);
  z-index: -1;
  box-sizing: border-box;
  box-shadow: 
    inset 0 0 0 1px color-mix(in srgb, var(--c-light) calc(var(--glass-reflex-light) * 15%), transparent),
    inset 2px 1px 0px -1px color-mix(in srgb, var(--c-light) calc(var(--glass-reflex-light) * 95%), transparent), 
    inset -1.5px -1px 0px -1px color-mix(in srgb, var(--c-light) calc(var(--glass-reflex-light) * 85%), transparent), 
    inset -2px -6px 1px -5px color-mix(in srgb, var(--c-light) calc(var(--glass-reflex-light) * 70%), transparent),
    inset 1px -2px 2px -1px color-mix(in srgb, var(--c-light) calc(var(--glass-reflex-light) * 40%), transparent),
    inset -1px 2px 3px -1px color-mix(in srgb, var(--c-dark) calc(var(--glass-reflex-dark) * 8%), transparent), 
    inset 0px -4px 1px -2px color-mix(in srgb, var(--c-dark) calc(var(--glass-reflex-dark) * 4%), transparent), 
    0px 2px 4px 0px color-mix(in srgb, var(--c-dark) calc(var(--glass-reflex-dark) * 3%), transparent),
    0px 1px 2px 0px color-mix(in srgb, var(--c-light) calc(var(--glass-reflex-light) * 20%), transparent);
  /* Tab switcher 滑块动画 - 使用变量 */
  transition: left var(--transition-slow) var(--ease-smooth),
              translate var(--transition-slow) var(--ease-smooth),
              background-color var(--transition-slow) var(--ease-glass),
              box-shadow var(--transition-slow) var(--ease-glass);
  will-change: left, translate;
}

.switcher__legend {
  position: absolute;
  width: 1px;
  height: 1px;
  margin: -1px;
  border: 0;
  padding: 0;
  white-space: nowrap;
  clip-path: inset(100%);
  clip: rect(0 0 0 0);
  overflow: hidden;
}

.switcher__input {
  clip: rect(0 0 0 0);
  clip-path: inset(100%);
  height: 1px;
  width: 1px;
  overflow: hidden;
  position: absolute;
  white-space: nowrap;
}

.switcher__icon {
  display: block;
  width: 100%;
  /* 通用图标过渡 - theme-switcher 和 tab-switcher 都会继承 */
  transition: color var(--transition-fast) var(--ease-smooth),
              scale var(--transition-fast) var(--ease-smooth);
}

.switcher__filter {
  position: absolute;
  width: 0;
  height: 0;
  z-index: -1;
}

/* 7. 内部选项 (Label) */
.switcher__option {
  --c: var(--c-content);
  display: flex;
  justify-content: center;
  align-items: center;
  box-sizing: border-box;
  overflow: hidden;
  border-radius: 99em;
  z-index: 10; /* 确保图标在 ::after 滑块之上 */
  position: relative;
  
  /*
    动画 - 通用选项过渡（theme-switcher 使用）
    - 动画 width, opacity, 和 transform
    - transform 实现了从右侧滑入效果
  */
  transition: width var(--transition-base) var(--ease-smooth), 
              opacity var(--transition-fast) var(--ease-smooth),
              transform var(--transition-base) var(--ease-smooth);
  will-change: width, opacity, transform;
}

/* Theme switcher hover 动效 - 完全隔离，不影响 tab-switcher */
.theme-switcher-container .theme-switcher-expanded .switcher__option:hover {
  --c: var(--c-action);
  cursor: pointer;
}

.theme-switcher-container[data-expanded="true"] .theme-switcher-expanded .switcher__option:hover .switcher__icon {
  scale: 1.2;
}

.theme-switcher-container[data-expanded="false"] .theme-switcher-expanded .switcher__option:hover .switcher__icon {
  scale: 1.15; /* 折叠态稍微小一点的缩放 */
}

/* 8. 内部选项 - 展开态 - 仅影响 theme-switcher */
.theme-switcher-container[data-expanded="true"] .theme-switcher-expanded .switcher__option {
  width: 3.4rem;
  height: 100%;
  padding: 0 0.8rem;
  opacity: 1;
  /* 
    关键：所有图标都从右侧滑入到中心位置
    匹配展开方向（从右向左）
    - 非激活图标：从 translateX(100%) 滑入到 translateX(0)
    - 激活图标：保持在 translateX(0)
  */
  transform: translateX(0);
  /*
    TIMING:
    - 延迟 100ms，等待容器先展开
  */
  transition-delay: 100ms; 
}

/* 9. 内部选项 - 折叠态 (Default) - 仅影响 theme-switcher */
.theme-switcher-container[data-expanded="false"] .theme-switcher-expanded .switcher__option {
  width: 0;
  height: 3rem; /* Match container */
  padding: 0;
  opacity: 0;
  /*
    关键修复：非激活图标从右侧开始
    匹配展开方向（从右向左展开）
  */
  transform: translateX(100%); 
  /*
    TIMING:
    - 收起时，非激活图标立即 (0ms) 开始淡出和收缩
  */
  transition-duration: 200ms;
  transition-delay: 0ms;
}

/* 10. 折叠态的 *激活* 选项 - 仅影响 theme-switcher */
.theme-switcher-container[data-expanded="false"] .theme-switcher-expanded .switcher__option:has(input:checked) {
  width: 3rem; /* 充满容器 */
  height: 3rem; /* 确保高度匹配 */
  opacity: 1; /* 保持可见 */
  /* 激活图标保持在中心位置，不移动 */
  transform: translateX(0); 
  /* 确保图标完美居中 - 无论哪个theme都居中 */
  display: flex;
  justify-content: center;
  align-items: center;
  padding: 0; /* 无内边距，确保居中 */
  margin: 0; /* 确保无外边距 */
  flex-shrink: 0; /* 防止被压缩 */
  transition-delay: 0ms;
  transition: width var(--transition-base) var(--ease-smooth),
              transform var(--transition-base) var(--ease-smooth),
              opacity 0ms; /* 保持可见，无过渡 */
}

/* 移除通用的 hover，已在上面的展开态中定义 */
.switcher__option:has(input:checked) {
  --c: var(--c-content);
  cursor: auto;
}

.switcher__option:has(input:checked) .switcher__icon {
  scale: 1;
}

/*
  FIX 1: "两层玻璃" (::after)
*/
.switcher::after {
  content: '';
  position: absolute;
  display: block;
  border-radius: 99em;
  background-color: color-mix(in srgb, var(--c-glass) 36%, transparent);
  z-index: 1; /* 提高 z-index，但在 icon (z-index: 10) 之下 */
  backdrop-filter: blur(8px) url(#switcher) saturate(var(--saturation));
  -webkit-backdrop-filter: blur(8px) saturate(var(--saturation));
  box-shadow: 
    inset 0 0 0 1px color-mix(in srgb, var(--c-light) calc(var(--glass-reflex-light) * 10%), transparent),
    inset 2px 1px 0px -1px color-mix(in srgb, var(--c-light) calc(var(--glass-reflex-light) * 90%), transparent), 
    inset -1.5px -1px 0px -1px color-mix(in srgb, var(--c-light) calc(var(--glass-reflex-light) * 80%), transparent), 
    inset -2px -6px 1px -5px color-mix(in srgb, var(--c-light) calc(var(--glass-reflex-light) * 60%), transparent), 
    inset -1px 2px 3px -1px color-mix(in srgb, var(--c-dark) calc(var(--glass-reflex-dark) * 20%), transparent), 
    inset 0px -4px 1px -2px color-mix(in srgb, var(--c-dark) calc(var(--glass-reflex-dark) * 10%), transparent), 
    0px 3px 6px 0px color-mix(in srgb, var(--c-dark) calc(var(--glass-reflex-dark) * 8%), transparent);
  
  /*
    动画:
    - 我们动画所有属性，以实现平滑形变
    - translate 动画是关键，确保滑块从右侧滑入到目标位置
  */
  /* Theme switcher 滑块动画 - 使用变量 */
  transition: width var(--transition-base) var(--ease-smooth),
              height var(--transition-base) var(--ease-smooth),
              translate var(--transition-slow) var(--ease-smooth), /* 平移稍慢，更平滑 */
              opacity var(--transition-fast) var(--ease-smooth),
              backdrop-filter var(--transition-slow) var(--ease-glass);
  will-change: width, height, translate, opacity;
}

/* 12. 滑块 - 折叠态 - 仅影响 theme-switcher */
.theme-switcher-container[data-expanded="false"] .theme-switcher-expanded::after {
  /*
    关键修复：折叠时，滑块完全透明并消失
    这解决了"两层玻璃"问题。
    容器 (fieldset) 本身在折叠时就是那个 3rem 的毛玻璃按钮。
  */
  width: 3rem;
  height: 3rem;
  left: 0;
  top: 0;
  /* 折叠时滑块位置不重要，因为它被隐藏了 */
  translate: 0 0;
  border-radius: 99em;
  opacity: 0; /* 隐藏 */
  visibility: hidden;
  transition-delay: 0ms; /* 立即隐藏 */
}

/* 13. 滑块 - 展开态基础样式 - 仅影响 theme-switcher */
.theme-switcher-container[data-expanded="true"] .theme-switcher-expanded::after {
  width: 4.2rem;
  height: calc(100% - 0.5rem);
  left: 0.2rem;
  top: 0.2rem;
  border-radius: 99em; /* 保持胶囊形 */
  opacity: 1; /* 出现 */
  visibility: visible;
  /*
    关键修复：展开时滑块从右侧开始滑入
    初始位置设置为右侧边缘（匹配展开方向从右向左）
    容器宽度 12.2rem，padding 0.6rem，所以滑块从右侧边缘滑入
  */
  /* 初始位置：从最右侧开始（对应 option 3 的位置，7.6rem）或更右侧 */
  translate: 11rem 0; /* 从右侧边缘滑入 */
  /*
    TIMING:
    - 延迟 100ms，与图标一起出现
    - translate 动画会平滑过渡到目标位置（由下面的 :has() 规则控制）
  */
  transition-delay: 100ms;
}

/*
  15. 替换为基于 *当前* 选中项的 translate 动画
  关键修复：滑块从右侧滑入到目标位置，匹配展开方向（从右向左）
*/
.theme-switcher-container[data-expanded="true"] .theme-switcher-expanded:has(input[data-option="1"]:checked)::after {
  /* option 1 在左侧，从右侧滑入 */
  translate: 0 0;
}

.theme-switcher-container[data-expanded="true"] .theme-switcher-expanded:has(input[data-option="2"]:checked)::after {
  /* option 2 在中间，从右侧滑入 */
  translate: 3.8rem 0;
}

.theme-switcher-container[data-expanded="true"] .theme-switcher-expanded:has(input[data-option="3"]:checked)::after {
  /* option 3 在右侧，从右侧滑入 */
  translate: 7.6rem 0;
}

/* Tab switcher 滑块位置动画 - 使用变量 */
.tab-switcher:has(input[data-option="1"]:checked)::after,
.tab-switcher:has(input[data-option="2"]:checked)::after {
  width: calc((100% - 0.8rem) / 2);
  translate: 0 0;
  transition: left var(--transition-slow) var(--ease-smooth),
              width var(--transition-slow) var(--ease-smooth),
              translate var(--transition-slow) var(--ease-smooth),
              background-color var(--transition-slow) var(--ease-glass),
              box-shadow var(--transition-slow) var(--ease-glass);
}

.tab-switcher:has(input[data-option="1"]:checked)::after {
  left: 0.4rem;
  transform-origin: right;
}

.tab-switcher:has(input[data-option="2"]:checked)::after {
  /* 计算右侧 tab 的位置：left = padding + 一个 tab 的宽度 */
  left: calc((100% - 0.8rem) / 2 + 0.4rem);
  transform-origin: left;
}

/* 基于 previous 状态优化动画方向 - 确保从正确方向滑入 */
.tab-switcher[data-previous="1"]:has(input[data-option="2"]:checked)::after {
  transform-origin: left;
}

.tab-switcher[data-previous="2"]:has(input[data-option="1"]:checked)::after {
  transform-origin: right;
}

/* Fade in animation for tags */
@keyframes fadeIn {
  from {
    opacity: 0;
    transform: translateY(-4px) scale(0.95);
  }
  to {
    opacity: 1;
    transform: translateY(0) scale(1);
  }
}

/* Tag animation classes - 只保留进入动画 */
.tag-enter {
  animation: fadeIn 0.3s cubic-bezier(0.4, 0, 0.2, 1) forwards;
}

/* ========================================
   STATS CLUSTER - 统计按钮组
   ======================================== */

/* StatsCluster 布局 */
.stats-cluster-container {
  display: flex;
  gap: 0.75rem; /* 12px */
  justify-content: center;
  margin-top: 1rem;
}

/* 单个 Stat 按钮 */
.glass-stat-button {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 0.6rem 0.5rem;
  border-radius: 1.2em; /* 匹配你的 liquidGlass-wrapper */
  
  /* 基础玻璃效果 (来自你的 globals.css) */
  background-color: color-mix(in srgb, var(--c-glass) 12%, transparent);
  backdrop-filter: blur(8px) saturate(var(--saturation));
  box-shadow: 
    inset 0 0 0 1px color-mix(in srgb, var(--c-light) calc(var(--glass-reflex-light) * 10%), transparent),
    inset 1.8px 3px 0px -2px color-mix(in srgb, var(--c-light) calc(var(--glass-reflex-light) * 90%), transparent), 
    inset -2px -2px 0px -2px color-mix(in srgb, var(--c-light) calc(var(--glass-reflex-light) * 80%), transparent), 
    inset -3px -8px 1px -6px color-mix(in srgb, var(--c-light) calc(var(--glass-reflex-light) * 60%), transparent), 
    inset -0.3px -1px 4px 0px color-mix(in srgb, var(--c-dark) calc(var(--glass-reflex-dark) * 12%), transparent), 
    inset -1.5px 2.5px 0px -2px color-mix(in srgb, var(--c-dark) calc(var(--glass-reflex-dark) * 20%), transparent), 
    inset 0px 3px 4px -2px color-mix(in srgb, var(--c-dark) calc(var(--glass-reflex-dark) * 20%), transparent), 
    inset 2px -6.5px 1px -4px color-mix(in srgb, var(--c-dark) calc(var(--glass-reflex-dark) * 10%), transparent), 
    0px 1px 5px 0px color-mix(in srgb, var(--c-dark) calc(var(--glass-reflex-dark) * 10%), transparent), 
    0px 6px 16px 0px color-mix(in srgb, var(--c-dark) calc(var(--glass-reflex-dark) * 8%), transparent);
  
  border: none;
  cursor: pointer;
  
  /* 多巴胺微交互 */
  transition: all 200ms var(--ease-smooth, ease-out);
}

.stat-icon {
  width: 1.25rem; /* 20px */
  height: 1.25rem;
  margin-bottom: 0.25rem;
  color: var(--c-action); /* 使用主题的 'action' 色 */
  transition: all 200ms var(--ease-smooth, ease-out);
}

.stat-value {
  font-family: "DM Sans", sans-serif;
  font-size: 1.1rem;
  font-weight: 700;
  color: var(--c-content);
  line-height: 1.2;
  transition: color 200ms var(--ease-smooth, ease-out);
}

.stat-label {
  font-family: "DM Sans", sans-serif;
  font-size: 0.65rem;
  font-weight: 500;
  color: color-mix(in srgb, var(--c-content) 60%, transparent);
  transition: color 200ms var(--ease-smooth, ease-out);
}

/* --- Hover 和 Click 效果 ---
 * (原则: 即时 > 延迟)
 */
.glass-stat-button:hover {
  transform: translateY(-3px);
  background-color: color-mix(in srgb, var(--c-glass) 18%, transparent);
  box-shadow: 
    inset 0 0 0 1px color-mix(in srgb, var(--c-light) calc(var(--glass-reflex-light) * 15%), transparent),
    inset 1.8px 3px 0px -2px color-mix(in srgb, var(--c-light) calc(var(--glass-reflex-light) * 95%), transparent), 
    inset -2px -2px 0px -2px color-mix(in srgb, var(--c-light) calc(var(--glass-reflex-light) * 85%), transparent), 
    inset -3px -8px 1px -6px color-mix(in srgb, var(--c-light) calc(var(--glass-reflex-light) * 70%), transparent), 
    inset -0.3px -1px 4px 0px color-mix(in srgb, var(--c-dark) calc(var(--glass-reflex-dark) * 15%), transparent), 
    inset -1.5px 2.5px 0px -2px color-mix(in srgb, var(--c-dark) calc(var(--glass-reflex-dark) * 25%), transparent), 
    inset 0px 3px 4px -2px color-mix(in srgb, var(--c-dark) calc(var(--glass-reflex-dark) * 25%), transparent), 
    inset 2px -6.5px 1px -4px color-mix(in srgb, var(--c-dark) calc(var(--glass-reflex-dark) * 15%), transparent), 
    0px 1px 5px 0px color-mix(in srgb, var(--c-dark) calc(var(--glass-reflex-dark) * 12%), transparent), 
    0px 10px 20px 0px color-mix(in srgb, var(--c-dark) calc(var(--glass-reflex-dark) * 12%), transparent);
}

/* 个性化 Hover 颜色 (原则: 表达 > 模板) */
.glass-stat-button[data-stat-type="streak"]:hover {
  box-shadow: 
    inset 0 0 0 1px color-mix(in srgb, var(--c-light) calc(var(--glass-reflex-light) * 15%), transparent),
    inset 1.8px 3px 0px -2px color-mix(in srgb, var(--c-light) calc(var(--glass-reflex-light) * 95%), transparent), 
    inset -2px -2px 0px -2px color-mix(in srgb, var(--c-light) calc(var(--glass-reflex-light) * 85%), transparent), 
    inset -3px -8px 1px -6px color-mix(in srgb, var(--c-light) calc(var(--glass-reflex-light) * 70%), transparent), 
    inset -0.3px -1px 4px 0px color-mix(in srgb, var(--c-dark) calc(var(--glass-reflex-dark) * 15%), transparent), 
    inset -1.5px 2.5px 0px -2px color-mix(in srgb, var(--c-dark) calc(var(--glass-reflex-dark) * 25%), transparent), 
    inset 0px 3px 4px -2px color-mix(in srgb, var(--c-dark) calc(var(--glass-reflex-dark) * 25%), transparent), 
    inset 2px -6.5px 1px -4px color-mix(in srgb, var(--c-dark) calc(var(--glass-reflex-dark) * 15%), transparent), 
    0px 1px 5px 0px color-mix(in srgb, var(--c-dark) calc(var(--glass-reflex-dark) * 12%), transparent), 
    0px 10px 20px -5px color-mix(in srgb, var(--c-action) 40%, transparent);
}

.glass-stat-button[data-stat-type="streak"]:hover .stat-icon {
  color: var(--c-action);
  transform: scale(1.1);
}

.glass-stat-button[data-stat-type="tagged"]:hover .stat-icon {
  color: var(--c-action);
  transform: scale(1.1);
}

.glass-stat-button[data-stat-type="completed"]:hover .stat-icon {
  color: var(--c-action);
  transform: scale(1.1);
}

.glass-stat-button:active {
  transform: translateY(-1px) scale(0.98);
  transition-duration: 100ms;
}

/* ========================================
   STATS WALL MODAL - 像素画廊
   ======================================== */

/* 像素画廊 (Stats Wall) 样式
 * 适配 Light / Dark / Dim 主题
 */
.stats-wall-backdrop {
  position: fixed;
  inset: 0;
  z-index: 200;
  display: flex;
  align-items: center;
  justify-content: center;
  
  /* 使用你的 glass 变量做背景 */
  background: color-mix(in srgb, var(--c-glass) 15%, transparent);
  backdrop-filter: blur(4px);
  
  /* 确保这个 modal 可以滚动，如果内容溢出 */
  overflow-y: auto;
  padding: 1rem;
}

.stats-wall-container {
  width: 100%;
  max-width: 420px; /* 比 popup 宽一点 */
  padding: 1rem 1.25rem;
  
  /* 为滚动优化 */
  margin: auto; 
  
  /* 使用更强烈的背景色，与底层区分 */
  background-color: color-mix(in srgb, var(--c-bg) 95%, transparent) !important;
  backdrop-filter: blur(16px) saturate(180%) !important;
  border: 1px solid color-mix(in srgb, var(--c-light) calc(var(--glass-reflex-light) * 20%), transparent);
}

.stats-wall-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 1rem;
}

.stats-wall-title {
  font-family: "DM Sans", sans-serif;
  font-size: 1.25rem;
  font-weight: 700;
  color: var(--c-content);
  margin: 0;
}

.close-button {
  /* 复用 GlassButton 的一些样式，但更轻量 */
  padding: 0.5rem;
  border-radius: 99em;
  background: color-mix(in srgb, var(--c-glass) 15%, transparent);
  color: var(--c-content);
  border: none;
  cursor: pointer;
  transition: all 150ms var(--ease-smooth, ease-out);
}

.close-button:hover {
  background: color-mix(in srgb, var(--c-action) 20%, transparent);
  color: var(--c-action);
}

/* 奖励进度条 (核心激励) */
.stats-wall-reward {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  background: color-mix(in srgb, var(--c-action) 12%, transparent);
  border: 1px solid color-mix(in srgb, var(--c-action) 30%, transparent);
  border-radius: 0.8em;
  padding: 0.75rem;
  margin-bottom: 1.5rem;
}

.reward-icon {
  color: var(--c-action);
  flex-shrink: 0;
}

.reward-info {
  flex: 1;
}

.reward-label {
  font-family: "DM Sans", sans-serif;
  font-size: 0.8rem;
  font-weight: 500;
  color: var(--c-content);
}

.reward-progress-bar {
  width: 100%;
  height: 6px;
  background: color-mix(in srgb, var(--c-glass) 20%, transparent);
  border-radius: 99em;
  margin-top: 4px;
  overflow: hidden;
}

.progress-fill {
  height: 100%;
  background: var(--c-action);
  border-radius: 99em;
  transition: width 300ms var(--ease-smooth, ease-out);
}

.reward-percent {
  font-family: "DM Sans", sans-serif;
  font-size: 0.8rem;
  font-weight: 600;
  color: var(--c-action);
}

/* 贡献墙网格 */
.stats-wall-grid-container {
  display: flex;
  gap: 6px;
  font-family: "DM Sans", sans-serif;
  font-size: 0.6rem;
  color: color-mix(in srgb, var(--c-content) 50%, transparent);
  margin-bottom: 1rem;
}

.stats-wall-days-y {
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  padding-top: 1.2rem; /* 留出 X 轴标签空间 */
  min-width: 2rem;
}

.stats-wall-grid-wrapper {
  flex: 1;
  display: flex;
  flex-direction: column;
}

.stats-wall-months-x {
  display: flex;
  gap: 2rem;
  margin-bottom: 4px;
  height: 1.2rem;
  align-items: center;
}

.stats-wall-grid {
  display: flex;
  flex-direction: row;
  gap: 3px;
  width: 100%;
  overflow-x: auto;
  overflow-y: hidden;
}

.stats-wall-week {
  display: flex;
  flex-direction: column;
  gap: 3px;
}

.pixel-day-tile {
  /* 改为固定尺寸的正方形 */
  width: 12px;
  height: 12px;
  border-radius: 3px;
  background: color-mix(in srgb, var(--c-glass) 15%, transparent);
  
  /* 添加 hover 效果 */
  transition: all 150ms ease-out;
  position: relative;
}

/* 适配主题的"多巴胺"颜色
 * (原则: 即时 > 延迟)
 */
.pixel-day-tile[data-level="1"] {
  background: color-mix(in srgb, var(--c-action) 30%, transparent);
}

.pixel-day-tile[data-level="2"] {
  background: color-mix(in srgb, var(--c-action) 60%, transparent);
}

.pixel-day-tile[data-level="3"] {
  background: color-mix(in srgb, var(--c-action) 100%, transparent);
}

.pixel-day-tile:hover {
  /* Hover: 放大并添加高光边框 */
  transform: scale(1.2);
  outline: 2px solid var(--c-action);
  z-index: 10;
  position: relative;
}

.share-button {
  width: 100%;
  margin-top: 1.5rem;
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 0.5rem;
  font-size: 0.9rem !important;
  /* 确保它能被点击 */
  z-index: 10;
}

/* ========================================
   TopBar V4 (Stealth HUD) 样式
   ======================================== */

.top-bar-container-v4 {
  position: absolute;
  /* (V4) 紧贴顶层 */
  top: 0;
  left: 0;
  right: 0;
  z-index: 50;
  
  /* (V8) 设定一个固定高度，48px */
  height: 3rem; 
  padding: 0 1rem; /* 16px 左右内边距 */
  
  /* (V8) 默认状态: 完全透明，没有边框和阴影 */
  background: transparent;
  backdrop-filter: none;
  border: none;
  box-shadow: none;
  border-radius: 0; /* (V8) 顶部无圆角 */

  /* (V8) 关键: 平滑地过渡所有属性 */
  transition: all 300ms var(--ease-smooth, ease-out);
}

/* * (V4) 核心: Hover 时 "浮现" Liquid Glass 效果 
 */
.top-bar-container-v4:hover {
  /* (V8) 复制 .liquidGlass-wrapper 的样式 */
  background-color: color-mix(in srgb, var(--c-bg) 50%, var(--c-glass) 15%);
  backdrop-filter: blur(12px) saturate(var(--saturation));
  
  /* (V8) 只在底部显示边框和圆角 */
  border-bottom: 1.5px solid color-mix(in srgb, var(--c-light) calc(var(--glass-reflex-light) * 15%), transparent);
  border-radius: 0 0 1.25em 1.25em; /* 底部圆角 20px */
  
  /* (V8) 复制 .liquidGlass-wrapper 的阴影 */
  box-shadow: 
    inset 0 0 0 1px color-mix(in srgb, var(--c-light) calc(var(--glass-reflex-light) * 10%), transparent),
    inset 1.8px 3px 0px -2px color-mix(in srgb, var(--c-light) calc(var(--glass-reflex-light) * 90%), transparent), 
    inset -2px -2px 0px -2px color-mix(in srgb, var(--c-light) calc(var(--glass-reflex-light) * 80%), transparent), 
    inset -3px -8px 1px -6px color-mix(in srgb, var(--c-light) calc(var(--glass-reflex-light) * 60%), transparent), 
    inset -0.3px -1px 4px 0px color-mix(in srgb, var(--c-dark) calc(var(--glass-reflex-dark) * 12%), transparent), 
    inset -1.5px 2.5px 0px -2px color-mix(in srgb, var(--c-dark) calc(var(--glass-reflex-dark) * 20%), transparent), 
    inset 0px 3px 4px -2px color-mix(in srgb, var(--c-dark) calc(var(--glass-reflex-dark) * 20%), transparent), 
    inset 2px -6.5px 1px -4px color-mix(in srgb, var(--c-dark) calc(var(--glass-reflex-dark) * 10%), transparent), 
    0px 1px 5px 0px color-mix(in srgb, var(--c-dark) calc(var(--glass-reflex-dark) * 10%), transparent), 
    0px 6px 16px 0px color-mix(in srgb, var(--c-dark) calc(var(--glass-reflex-dark) * 8%), transparent);
}

/* V4: 内部 Flex 容器 */
.top-bar-content-v4 {
  display: flex;
  justify-content: space-between;
  align-items: center;
  height: 100%; /* 继承父级高度 */
}

/* V4: 左侧的 Stats 按钮组 */
.top-bar-stats-group-v4 {
  display: flex;
  align-items: center;
  gap: 0.25rem; /* 4px */
}

/* V4: 内部按钮 (默认 "Stealth" 状态) */
.top-bar-button-v4 {
  display: flex;
  align-items: center;
  gap: 0.35rem; /* 6px */
  
  /* (V8) 默认完全透明 */
  background: transparent;
  border: none;
  border-radius: 99em;
  padding: 0.5rem 0.7rem; /* 8px 11px */
  cursor: pointer;
  
  /* (V8) 默认颜色: 几乎不可见 */
  color: color-mix(in srgb, var(--c-content) 30%, transparent);
  transform: scale(0.95);
  opacity: 0.7;
  
  transition: all 200ms var(--ease-smooth, ease-out);
}

/* V4: 鼠标悬停在 *Bar* 上时，按钮的 "唤醒" 状态 */
.top-bar-container-v4:hover .top-bar-button-v4 {
  color: color-mix(in srgb, var(--c-content) 70%, transparent);
  transform: scale(1);
  opacity: 1;
}

/* V4: 鼠标悬停在 *按钮* 上时的 "高亮" 状态 */
.top-bar-button-v4:hover {
  background: color-mix(in srgb, var(--c-glass) 25%, transparent);
  color: var(--c-content);
  transform: scale(1.05); /* 放大 */
}
.top-bar-button-v4:active {
  transform: scale(0.96); /* 点击缩小 */
}

/* V4: 连胜 (Streak) 按钮 - 永久可见 */
.top-bar-button-v4[data-stat-type="streak"] {
  color: var(--c-action);
  transform: scale(1);
  opacity: 1;
}

/* V4: 连胜按钮在 Bar Hover 时的特殊样式 */
.top-bar-container-v4:hover .top-bar-button-v4[data-stat-type="streak"] {
  background: color-mix(in srgb, var(--c-action) 15%, transparent);
  color: var(--c-action);
}

/* V4: 设置按钮图标 */
.top-bar-icon-v4 {
  width: 0.8rem; /* 13px */
  height: 0.8rem;
  stroke-width: 2.5;
}
.top-bar-value-v4 {
  font-family: "DM Sans", sans-serif;
  font-size: 0.8rem; /* 13px */
  font-weight: 600;
  line-height: 1;
}

/* V4: 设置按钮的特殊样式 */
.top-bar-button-v4.settings {
  padding: 0.6rem; /* 10px */
}
.top-bar-button-v4.settings .settings-icon {
  width: 1rem; /* 16px */
  height: 1rem;
  stroke-width: 2;
  margin: 0;
}

/* V4: 设置按钮的 Hover 效果 (独立于 Streak) */
.top-bar-button-v4.settings:hover {
  background: color-mix(in srgb, var(--c-action) 20%, transparent);
  color: var(--c-action);
  transform: scale(1.05);
}
