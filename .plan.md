# 重构主题切换功能

## 目标

1. 从 SettingsModal 中移除 ThemeSwitcher 组件
2. 在 SettingsModal 中内置简化的主题切换功能（点击循环切换：light -> dark -> dim -> light）
3. 将 ThemeSwitcher 的完整功能抽象为通用的可复用基础组件（接受任意选项配置，包含展开/收起交互逻辑）

## 实施步骤

### 1. 创建通用基础组件 `ExpandableSwitcher`

- 文件：`src/popup/components/ExpandableSwitcher.tsx`
- 从 `ThemeSwitcher.tsx` 中提取完整的交互和视觉效果：
  - **展开/收起交互逻辑**（hover 展开、鼠标离开延迟关闭、backdrop 点击关闭）
  - 滑块动画和视觉效果（SVG 滤镜、previousValue 状态等）
  - 不包含具体的选项和图标（通过 props 传入）
  - 不包含存储和业务逻辑（这些由父组件处理）
- 提供通用接口：
  - `options`: 选项数组，每个选项包含 `{ value: string, icon: React.ComponentType, option: string }`
  - `value`: 当前选中的值
  - `onChange`: 值变化回调
  - `legend`: legend 文本（可选）
  - `name`: input 的 name 属性
  - `filterId`: SVG 滤镜的 ID（可选，用于避免多个实例冲突）
- 保持原有的所有交互行为和视觉效果

### 2. 修改 SettingsModal

- 移除 `ThemeSwitcher` 的导入和使用
- 添加主题状态管理（使用 `useState` 和 `initialTheme`）
- 实现主题切换逻辑：
  - 点击 Theme 行时循环切换主题
  - 调用 `storageService.set(STORAGE_KEYS.THEME, newTheme)` 保存
  - 调用 `applyThemeToBody(newTheme)` 应用主题
- 在 SettingsRow 中显示当前主题名称（类似 App Icon 的显示方式）
- 使用 `ChevronRight` 图标作为 control，表示可点击

### 3. 保留 ThemeSwitcher 组件（暂时不使用）

- 保持 `ThemeSwitcher.tsx` 文件不变
- 保持 `ThemeSwitcher.stories.tsx` 不变
- 保持相关 CSS 样式不变

## 涉及的文件

- `src/popup/components/ThemeSwitcher.tsx` - 参考提取完整交互逻辑和视觉效果
- `src/popup/components/SettingsModal.tsx` - 移除 ThemeSwitcher，添加内置主题切换
- `src/popup/components/ExpandableSwitcher.tsx` - 新建通用基础组件（包含展开/收起交互，接受任意选项配置，暂时不使用）

## 注意事项

- ExpandableSwitcher 应该是完全通用的组件，不包含任何业务逻辑
- 选项配置通过 props 传入，支持任意数量的选项
- SVG 滤镜 ID 应该可配置，避免多个实例之间的冲突
- SettingsModal 中的主题切换应该与 App Icon 切换保持一致的交互模式
- 确保主题切换后能正确保存和应用

